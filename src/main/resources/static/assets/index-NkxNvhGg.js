import{c as a,a as G,r as F,o as h,b as s,t as c,d as u,e as L,f as k,n as w,F as U,g as C,w as y,v,h as f,i as E,j as x,k as D,l as R,m as O}from"./vendor-ycAeC7vs.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const b=(t,e)=>{const n=t.__vccOpts||t;for(const[l,i]of e)n[l]=i;return n},A={name:"App"},N={class:"app"};function J(t,e,n,l,i,o){const r=F("router-view");return h(),a("div",N,[G(r)])}const j=b(A,[["render",J]]),_={name:"Index",data(){return{currentUser:null,showUserMenu:!1,beianImageUrl:"/beian.png"}},mounted(){this.checkLoginStatus()},methods:{checkLoginStatus(){const t=localStorage.getItem("pacman_user");t&&(this.currentUser=JSON.parse(t))},toggleUserMenu(){this.showUserMenu=!this.showUserMenu},logout(){localStorage.removeItem("pacman_user"),this.currentUser=null,this.showUserMenu=!1}}},z={class:"index"},B={class:"container"},q={class:"header"},V={key:0,class:"user-info"},Q={class:"relative"},K={key:0,class:"user-menu"},W={class:"hero"},$={class:"game-entries"},Y={class:"footer"},H={style:{color:"white"},href:"https://beian.mps.gov.cn/#/query/webSearch?code=44030002010783",rel:"noreferrer",target:"_blank"},Z=["src"];function X(t,e,n,l,i,o){return h(),a("div",z,[s("div",B,[e[18]||(e[18]=s("h1",null,"小财神摸鱼club",-1)),s("div",q,[i.currentUser?(h(),a("div",V,[s("div",Q,[s("button",{class:"btn",onClick:e[0]||(e[0]=(...r)=>o.toggleUserMenu&&o.toggleUserMenu(...r))},c(i.currentUser.username),1),i.showUserMenu?(h(),a("div",K,[s("button",{onClick:e[1]||(e[1]=(...r)=>o.logout&&o.logout(...r))},"退出登录"),s("button",{onClick:e[2]||(e[2]=r=>t.$router.push("/login?action=change"))},"修改密码")])):u("",!0)])])):u("",!0)]),s("div",W,[s("div",$,[s("div",{class:"game-card pacman",onClick:e[3]||(e[3]=r=>t.$router.push("/leaderboard")),style:{cursor:"pointer"}},[...e[10]||(e[10]=[s("h2",null,"吃豆豆",-1),s("div",{class:"game-icon"},[s("div",{class:"pacman-icon"})],-1),s("p",null,"经典吃豆豆游戏，挑战你的反应能力",-1)])]),s("div",{class:"game-card tetris",onClick:e[4]||(e[4]=r=>t.$router.push("/tetris-leaderboard")),style:{cursor:"pointer"}},[...e[11]||(e[11]=[s("h2",null,"俄罗斯方块",-1),s("div",{class:"game-icon"},[s("div",{class:"tetris-icon"})],-1),s("p",null,"经典俄罗斯方块游戏，挑战你的策略能力",-1)])]),s("div",{class:"game-card mbti",onClick:e[5]||(e[5]=r=>t.$router.push("/mbti-test")),style:{cursor:"pointer"}},[...e[12]||(e[12]=[s("h2",null,"MBTI 测试",-1),s("div",{class:"game-icon"},[s("div",{class:"mbti-icon"})],-1),s("p",null,"了解你的人格类型，探索自我",-1)])]),s("div",{class:"game-card tank",onClick:e[6]||(e[6]=r=>t.$router.push("/tank-game")),style:{cursor:"pointer"}},[...e[13]||(e[13]=[s("h2",null,"坦克大战",-1),s("div",{class:"game-icon"},[s("div",{class:"tank-icon"})],-1),s("p",null,"经典坦克大战游戏，挑战你的策略能力",-1)])]),s("div",{class:"game-card bomberman",onClick:e[7]||(e[7]=r=>t.$router.push("/bomberman-game")),style:{cursor:"pointer"}},[...e[14]||(e[14]=[s("h2",null,"炸弹人",-1),s("div",{class:"game-icon"},[s("div",{class:"bomberman-icon"})],-1),s("p",null,"经典炸弹人游戏，挑战你的策略能力",-1)])])])]),e[19]||(e[19]=L('<section id="about" data-v-4e1ef70a><div class="about-content" data-v-4e1ef70a><div class="about-text" style="text-align:center;" data-v-4e1ef70a><h2 data-v-4e1ef70a>关于我</h2><p data-v-4e1ef70a>一个很能折腾的产品经理。</p></div></div></section><section id="contact" data-v-4e1ef70a><h2 data-v-4e1ef70a>联系方式</h2><div class="contact-content" data-v-4e1ef70a><p data-v-4e1ef70a>想吃屁并没有任何联系方式，就一个美国号码确实是我的想存就存</p><div class="contact-info" data-v-4e1ef70a><div class="contact-item" data-v-4e1ef70a><h3 data-v-4e1ef70a>邮箱</h3><p data-v-4e1ef70a>懂得都懂</p></div><div class="contact-item" data-v-4e1ef70a><h3 data-v-4e1ef70a>电话</h3><p data-v-4e1ef70a>+1 4245974563</p></div><div class="contact-item" data-v-4e1ef70a><h3 data-v-4e1ef70a>社交媒体</h3><p data-v-4e1ef70a>不该问的少问</p></div></div></div></section>',2)),s("div",Y,[i.currentUser?u("",!0):(h(),a("button",{key:0,class:"btn btn-secondary",onClick:e[8]||(e[8]=r=>t.$router.push("/login"))},"登录")),i.currentUser?u("",!0):(h(),a("button",{key:1,class:"btn btn-secondary",onClick:e[9]||(e[9]=r=>t.$router.push("/register"))},"注册")),e[16]||(e[16]=s("p",null,"© 2026 AAA小财神来咯来咯左手抓金元宝右手抱聚宝盆脚踩祥云头顶福数钱数到手抽筋咯什么手抽筋了要不要我给你按。保留所有权利",-1)),e[17]||(e[17]=s("a",{style:{color:"white"},href:"https://beian.miit.gov.cn/",target:"_blank"},"粤ICP备2026017648",-1)),s("a",H,[s("img",{src:i.beianImageUrl,width:"15",height:"15"},null,8,Z),e[15]||(e[15]=k("粤公网安备44030002010783号",-1))])])])])}const ee=b(_,[["render",X],["__scopeId","data-v-4e1ef70a"]]),te={name:"Leaderboard",data(){return{scores:[],loading:!1,message:"",messageType:"",currentUser:null,showUserMenu:!1,userScore:null,userRank:null}},mounted(){this.checkLoginStatus(),this.getLeaderboard()},methods:{checkLoginStatus(){const t=localStorage.getItem("pacman_user");t&&(this.currentUser=JSON.parse(t),this.fetchUserScore())},truncateUsername(t,e){return t.length<=e?t:t.substring(0,e-2)+".."},async fetchUserScore(){if(this.currentUser)try{const e=await(await fetch(`/api/scores/user/${this.currentUser.id}`)).json();e.rank&&(this.userRank=e.rank,this.userScore={score:e.score,time_used:e.time_used,device_type:e.device_type||"desktop"})}catch(t){console.error("获取用户分数失败:",t)}},toggleUserMenu(){this.showUserMenu=!this.showUserMenu},logout(){localStorage.removeItem("pacman_user"),this.currentUser=null,this.showUserMenu=!1,this.getLeaderboard()},async changeUsername(){const t=this.currentUser.username,e=prompt("请输入新的用户名:",t);if(e===null)return;const n=e.trim();if(n!==t&&n)try{const i=await(await fetch("/api/auth/update_username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:this.currentUser.id,new_username:n})})).json();i.error?alert(i.error):(this.currentUser.username=n,localStorage.setItem("pacman_user",JSON.stringify(this.currentUser)),this.getLeaderboard(),this.fetchUserScore(),alert("用户名修改成功"))}catch(l){console.error("修改用户名失败:",l),alert("修改用户名失败，请稍后重试")}},async getLeaderboard(){this.loading=!0;try{const e=await(await fetch("/api/scores?limit=20")).json();this.scores=e.scores||[]}catch(t){console.error("获取排行榜失败:",t),this.message="获取排行榜失败，请刷新页面",this.messageType="error"}finally{this.loading=!1}}}},se={class:"leaderboard"},ie={class:"container"},re={class:"header"},ne={key:0,class:"user-info"},oe={class:"relative"},le=["title"],ae={key:0,class:"user-menu"},he={key:1,class:"user-info"},ce={key:0,class:"message info"},de={key:2,class:"leaderboard-table"},ue={key:0,class:"user-row"},me=["title"],pe=["title"],ge={key:1},fe={key:3,class:"loading"},ye={class:"footer"};function ve(t,e,n,l,i,o){return h(),a("div",se,[s("div",ie,[e[13]||(e[13]=s("h1",null,"吃豆豆 - 排行榜",-1)),s("div",re,[i.currentUser?(h(),a("div",ne,[s("div",oe,[s("button",{class:"btn",onClick:e[0]||(e[0]=(...r)=>o.toggleUserMenu&&o.toggleUserMenu(...r)),title:i.currentUser.username},c(o.truncateUsername(i.currentUser.username,8)),9,le),i.showUserMenu?(h(),a("div",ae,[s("button",{onClick:e[1]||(e[1]=(...r)=>o.logout&&o.logout(...r))},"退出登录"),s("button",{onClick:e[2]||(e[2]=r=>t.$router.push("/login?action=change"))},"修改密码"),s("button",{onClick:e[3]||(e[3]=(...r)=>o.changeUsername&&o.changeUsername(...r))},"修改用户名")])):u("",!0)])])):(h(),a("div",he,[...e[9]||(e[9]=[s("p",null,"未登录",-1)])]))]),i.currentUser?u("",!0):(h(),a("div",ce," 如需将成绩计入排行榜，请先登录 ")),i.message?(h(),a("div",{key:1,class:w(["message",i.messageType])},c(i.message),3)):u("",!0),i.loading?u("",!0):(h(),a("table",de,[e[11]||(e[11]=s("thead",null,[s("tr",null,[s("th",null,"排名"),s("th",null,"用户名"),s("th",null,"用时"),s("th",null,"分数"),s("th",null,"设备")])],-1)),s("tbody",null,[i.userScore?(h(),a("tr",ue,[s("td",null,c(i.userRank),1),s("td",{title:i.currentUser.username},c(o.truncateUsername(i.currentUser.username,12))+" (你)",9,me),s("td",null,c(i.userScore.time_used)+"秒",1),s("td",null,c(i.userScore.score),1),s("td",null,c(i.userScore.device_type==="mobile"?"手机":"电脑"),1)])):u("",!0),(h(!0),a(U,null,C(i.scores,r=>(h(),a("tr",{key:r.rank},[s("td",null,c(r.rank),1),s("td",{title:r.username},c(o.truncateUsername(r.username,12)),9,pe),s("td",null,c(r.time_used)+"秒",1),s("td",null,c(r.score),1),s("td",null,c(r.device_type==="mobile"?"手机":"电脑"),1)]))),128)),i.scores.length===0?(h(),a("tr",ge,[...e[10]||(e[10]=[s("td",{colspan:"5",style:{"text-align":"center",padding:"20px"}},"暂无排行榜数据",-1)])])):u("",!0)])])),i.loading?(h(),a("div",fe,[...e[12]||(e[12]=[s("p",null,"加载中...",-1)])])):u("",!0),s("div",ye,[s("button",{class:"btn",onClick:e[4]||(e[4]=r=>t.$router.push("/"))},"返回首页"),s("button",{class:"btn",onClick:e[5]||(e[5]=r=>t.$router.push("/game"))},"开始游戏"),i.currentUser?u("",!0):(h(),a("button",{key:0,class:"btn btn-secondary",onClick:e[6]||(e[6]=r=>t.$router.push("/login"))},"登录")),i.currentUser?u("",!0):(h(),a("button",{key:1,class:"btn btn-secondary",onClick:e[7]||(e[7]=r=>t.$router.push("/register"))},"注册")),s("button",{class:"btn btn-secondary",onClick:e[8]||(e[8]=r=>t.$router.push("/tetris-leaderboard"))},"俄罗斯方块排行榜")])])])}const be=b(te,[["render",ve],["__scopeId","data-v-85812afb"]]),we={name:"Login",data(){return{activeForm:"login",message:"",messageType:"",loginForm:{account:"",password:""},resetForm:{account:"",securityAnswer:"",newPassword:""},changeForm:{account:"",oldPassword:"",newPassword:""},currentUser:null}},mounted(){this.checkLoginStatus(),this.checkQueryParams()},methods:{checkLoginStatus(){const t=localStorage.getItem("pacman_user");t&&(this.currentUser=JSON.parse(t),this.changeForm.account=this.currentUser.account)},checkQueryParams(){this.$route.query.action==="change"&&(this.activeForm="change")},async doLogin(){if(!this.loginForm.account||!this.loginForm.password){this.message="请输入账号和密码",this.messageType="error";return}try{const e=await(await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.loginForm)})).json();e.user?(localStorage.setItem("pacman_user",JSON.stringify(e.user)),this.message="登录成功",this.messageType="success",setTimeout(()=>{this.$router.push("/leaderboard")},1e3)):(this.message="登录失败: "+e.error,this.messageType="error")}catch(t){console.error("登录失败:",t),this.message="登录失败，请检查网络连接",this.messageType="error"}},async doResetPassword(){if(!this.resetForm.account||!this.resetForm.securityAnswer||!this.resetForm.newPassword){this.message="请填写所有必填项",this.messageType="error";return}try{const e=await(await fetch("/api/auth/reset_password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:this.resetForm.account,security_answer:this.resetForm.securityAnswer,new_password:this.resetForm.newPassword})})).json();e.message==="密码重置成功"?(this.message="密码重置成功，请登录",this.messageType="success",setTimeout(()=>{this.activeForm="login"},1e3)):(this.message="重置密码失败: "+e.error,this.messageType="error")}catch(t){console.error("重置密码失败:",t),this.message="重置密码失败，请检查网络连接",this.messageType="error"}},async doChangePassword(){if(!this.changeForm.account||!this.changeForm.oldPassword||!this.changeForm.newPassword){this.message="请填写所有必填项",this.messageType="error";return}this.message="修改密码功能需要后端支持，当前仅为演示",this.messageType="error"}}},ke={class:"login"},xe={class:"container"},Pe={key:0},Te={class:"form-group"},Ie={class:"form-group"},Se={class:"links"},Ue={key:1},Ce={class:"form-group"},Me={class:"form-group"},Ge={class:"form-group"},Fe={key:2},Le={class:"form-group"},Ee={class:"form-group"},De={class:"form-group"},Re={class:"footer"};function Oe(t,e,n,l,i,o){return h(),a("div",ke,[s("div",xe,[e[28]||(e[28]=s("h1",null,"吃豆豆",-1)),i.activeForm==="login"?(h(),a("div",Pe,[e[19]||(e[19]=s("h2",null,"登录",-1)),i.message?(h(),a("div",{key:0,class:w(["message",i.messageType])},c(i.message),3)):u("",!0),s("div",Te,[e[17]||(e[17]=s("label",{for:"account"},"账号:",-1)),y(s("input",{type:"text",id:"account","onUpdate:modelValue":e[0]||(e[0]=r=>i.loginForm.account=r),placeholder:"请输入账号"},null,512),[[v,i.loginForm.account]])]),s("div",Ie,[e[18]||(e[18]=s("label",{for:"password"},"密码:",-1)),y(s("input",{type:"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=r=>i.loginForm.password=r),placeholder:"请输入密码"},null,512),[[v,i.loginForm.password]])]),s("button",{class:"btn",onClick:e[2]||(e[2]=(...r)=>o.doLogin&&o.doLogin(...r))},"登录"),s("div",Se,[s("a",{href:"#",onClick:e[3]||(e[3]=f(r=>i.activeForm="reset",["prevent"]))},"忘记密码?"),s("a",{href:"#",onClick:e[4]||(e[4]=f(r=>t.$router.push("/register"),["prevent"]))},"注册账号")])])):u("",!0),i.activeForm==="reset"?(h(),a("div",Ue,[e[23]||(e[23]=s("h2",null,"找回密码",-1)),i.message?(h(),a("div",{key:0,class:w(["message",i.messageType])},c(i.message),3)):u("",!0),s("div",Ce,[e[20]||(e[20]=s("label",{for:"resetAccount"},"账号:",-1)),y(s("input",{type:"text",id:"resetAccount","onUpdate:modelValue":e[5]||(e[5]=r=>i.resetForm.account=r),placeholder:"请输入账号"},null,512),[[v,i.resetForm.account]])]),s("div",Me,[e[21]||(e[21]=s("label",{for:"resetSecurityAnswer"},"密保答案:",-1)),y(s("input",{type:"text",id:"resetSecurityAnswer","onUpdate:modelValue":e[6]||(e[6]=r=>i.resetForm.securityAnswer=r),placeholder:"请输入密保答案"},null,512),[[v,i.resetForm.securityAnswer]])]),s("div",Ge,[e[22]||(e[22]=s("label",{for:"resetNewPassword"},"新密码:",-1)),y(s("input",{type:"password",id:"resetNewPassword","onUpdate:modelValue":e[7]||(e[7]=r=>i.resetForm.newPassword=r),placeholder:"请输入新密码"},null,512),[[v,i.resetForm.newPassword]])]),s("button",{class:"btn",onClick:e[8]||(e[8]=(...r)=>o.doResetPassword&&o.doResetPassword(...r))},"重置密码"),s("button",{class:"btn btn-secondary",onClick:e[9]||(e[9]=r=>i.activeForm="login")},"返回登录")])):u("",!0),i.activeForm==="change"?(h(),a("div",Fe,[e[27]||(e[27]=s("h2",null,"修改密码",-1)),i.message?(h(),a("div",{key:0,class:w(["message",i.messageType])},c(i.message),3)):u("",!0),s("div",Le,[e[24]||(e[24]=s("label",{for:"changeAccount"},"账号:",-1)),y(s("input",{type:"text",id:"changeAccount","onUpdate:modelValue":e[10]||(e[10]=r=>i.changeForm.account=r),disabled:""},null,512),[[v,i.changeForm.account]])]),s("div",Ee,[e[25]||(e[25]=s("label",{for:"changeOldPassword"},"旧密码:",-1)),y(s("input",{type:"password",id:"changeOldPassword","onUpdate:modelValue":e[11]||(e[11]=r=>i.changeForm.oldPassword=r),placeholder:"请输入旧密码"},null,512),[[v,i.changeForm.oldPassword]])]),s("div",De,[e[26]||(e[26]=s("label",{for:"changeNewPassword"},"新密码:",-1)),y(s("input",{type:"password",id:"changeNewPassword","onUpdate:modelValue":e[12]||(e[12]=r=>i.changeForm.newPassword=r),placeholder:"请输入新密码"},null,512),[[v,i.changeForm.newPassword]])]),s("button",{class:"btn",onClick:e[13]||(e[13]=(...r)=>o.doChangePassword&&o.doChangePassword(...r))},"修改密码"),s("button",{class:"btn btn-secondary",onClick:e[14]||(e[14]=r=>t.$router.push("/leaderboard"))},"返回排行榜")])):u("",!0),s("div",Re,[s("button",{class:"btn btn-secondary",onClick:e[15]||(e[15]=r=>t.$router.push("/game"))},"返回游戏"),s("button",{class:"btn btn-secondary",onClick:e[16]||(e[16]=r=>t.$router.push("/leaderboard"))},"查看排行榜")])])])}const Ae=b(we,[["render",Oe],["__scopeId","data-v-6d647856"]]),Ne={name:"Register",data(){return{message:"",messageType:"",registerForm:{username:"",account:"",password:"",securityQuestion:"",securityAnswer:""}}},methods:{async doRegister(){if(!this.registerForm.username||!this.registerForm.account||!this.registerForm.password||!this.registerForm.securityQuestion||!this.registerForm.securityAnswer){this.message="请填写所有必填项",this.messageType="error";return}try{const e=await(await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.registerForm.username,account:this.registerForm.account,password:this.registerForm.password,security_question:this.registerForm.securityQuestion,security_answer:this.registerForm.securityAnswer})})).json();e.message==="注册成功"?(this.message="注册成功，请登录",this.messageType="success",setTimeout(()=>{this.$router.push("/login")},1e3)):(this.message="注册失败: "+e.error,this.messageType="error")}catch(t){console.error("注册失败:",t),this.message="注册失败，请检查网络连接",this.messageType="error"}}}},Je={class:"register"},je={class:"container"},_e={class:"form-group"},ze={class:"form-group"},Be={class:"form-group"},qe={class:"form-group"},Ve={class:"form-group"},Qe={class:"links"},Ke={class:"footer"};function We(t,e,n,l,i,o){return h(),a("div",Je,[s("div",je,[e[14]||(e[14]=s("h1",null,"吃豆豆",-1)),e[15]||(e[15]=s("h2",null,"注册账号",-1)),i.message?(h(),a("div",{key:0,class:w(["message",i.messageType])},c(i.message),3)):u("",!0),s("div",_e,[e[9]||(e[9]=s("label",{for:"username"},"用户名:",-1)),y(s("input",{type:"text",id:"username","onUpdate:modelValue":e[0]||(e[0]=r=>i.registerForm.username=r),placeholder:"请输入用户名"},null,512),[[v,i.registerForm.username]])]),s("div",ze,[e[10]||(e[10]=s("label",{for:"account"},"账号:",-1)),y(s("input",{type:"text",id:"account","onUpdate:modelValue":e[1]||(e[1]=r=>i.registerForm.account=r),placeholder:"请输入账号"},null,512),[[v,i.registerForm.account]])]),s("div",Be,[e[11]||(e[11]=s("label",{for:"password"},"密码:",-1)),y(s("input",{type:"password",id:"password","onUpdate:modelValue":e[2]||(e[2]=r=>i.registerForm.password=r),placeholder:"请输入密码"},null,512),[[v,i.registerForm.password]])]),s("div",qe,[e[12]||(e[12]=s("label",{for:"securityQuestion"},"密保问题:",-1)),y(s("input",{type:"text",id:"securityQuestion","onUpdate:modelValue":e[3]||(e[3]=r=>i.registerForm.securityQuestion=r),placeholder:"请输入密保问题"},null,512),[[v,i.registerForm.securityQuestion]])]),s("div",Ve,[e[13]||(e[13]=s("label",{for:"securityAnswer"},"密保答案:",-1)),y(s("input",{type:"text",id:"securityAnswer","onUpdate:modelValue":e[4]||(e[4]=r=>i.registerForm.securityAnswer=r),placeholder:"请输入密保答案"},null,512),[[v,i.registerForm.securityAnswer]])]),s("button",{class:"btn",onClick:e[5]||(e[5]=(...r)=>o.doRegister&&o.doRegister(...r))},"注册"),s("div",Qe,[s("a",{href:"#",onClick:e[6]||(e[6]=f(r=>t.$router.push("/login"),["prevent"]))},"已有账号？立即登录")]),s("div",Ke,[s("button",{class:"btn btn-secondary",onClick:e[7]||(e[7]=r=>t.$router.push("/game"))},"返回游戏"),s("button",{class:"btn btn-secondary",onClick:e[8]||(e[8]=r=>t.$router.push("/leaderboard"))},"查看排行榜")])])])}const $e=b(Ne,[["render",We],["__scopeId","data-v-1b858056"]]),Ye={name:"PacmanGame",data(){return{GRID_SIZE:20,CELL_SIZE:20,GAME_SPEED:130,SAFE_TIME:3e3,LONG_PRESS_DELAY:100,gameStartTime:0,timeUsed:0,timeInterval:null,currentUser:null,canvas:null,ctx:null,gameGrid:[],pacman:{x:1,y:18,direction:"up",nextDirection:"up",width:16,height:16,angle:0},ghosts:[],score:0,gameInterval:null,isGameRunning:!1,isPaused:!1,isGameOver:!1,keyState:{},longPressTimer:null,longPressInterval:null,mobileLongPressTimer:null,mobileLongPressInterval:null,touchState:{up:!1,left:!1,down:!1,right:!1},map:["####################","#........#........#","#o##.###.#.###.##o#","#.................#","#.##.#.#####.#.##.#","#....#...#...#....#","####.### # ###.####","   #.#       #.#   ","####.# ##=## #.####","     .  # #  .     ","####.# ##### #.####","   #.#       #.#   ","####.#.#####.#.####","#........#........#","#.##.###.#.###.##.#","#o..#........#..o#","##.#.#.#####.#.#.##","#.................#","#.##.###.#.###.##.#","####################"]}},computed:{gameButtonText(){return this.isGameRunning?this.isPaused?"继续游戏":"暂停游戏":"开始游戏"}},mounted(){this.canvas=this.$refs.gameCanvas,this.ctx=this.canvas.getContext("2d"),this.setCanvasSize(),this.initGame(),this.checkLoginStatus(),this.addEventListeners()},beforeUnmount(){this.clearIntervals(),this.removeEventListeners()},methods:{setCanvasSize(){const t=this.canvas.parentElement;this.canvas.width=t.clientWidth,this.canvas.height=t.clientHeight},initGame(){this.createGameGrid(),this.createGhosts(),this.drawGame()},createGameGrid(){this.gameGrid=[];for(let t=0;t<this.GRID_SIZE;t++){this.gameGrid[t]=[];for(let e=0;e<this.GRID_SIZE;e++){const n=this.map[t][e];this.gameGrid[t][e]={type:n,visited:!1}}}},createGhosts(){this.ghosts=[{x:8,y:6,direction:"left",color:"#ff6666",isAfraid:!1,afraidTimer:0},{x:10,y:6,direction:"right",color:"#66ccff",isAfraid:!1,afraidTimer:0},{x:12,y:6,direction:"left",color:"#ffcc66",isAfraid:!1,afraidTimer:0},{x:10,y:4,direction:"down",color:"#cc66ff",isAfraid:!1,afraidTimer:0}]},drawGame(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const t=Math.min(this.canvas.width,this.canvas.height)/this.GRID_SIZE;for(let e=0;e<this.GRID_SIZE;e++)for(let n=0;n<this.GRID_SIZE;n++){const l=this.gameGrid[e][n];l.type==="#"||l.type==="="?(this.ctx.fillStyle="#0033cc",this.ctx.fillRect(n*t,e*t,t,t),this.ctx.strokeStyle="#0066ff",this.ctx.strokeRect(n*t,e*t,t,t)):l.type==="."?(this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.arc(n*t+t/2,e*t+t/2,t*.1,0,Math.PI*2),this.ctx.fill()):l.type==="o"&&(this.ctx.fillStyle="#ffcc00",this.ctx.beginPath(),this.ctx.arc(n*t+t/2,e*t+t/2,t*.2,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowColor="#ffcc00",this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.arc(n*t+t/2,e*t+t/2,t*.2,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0)}this.drawPacman(t),this.drawGhosts(t)},drawPacman(t){const e=t*.8,n=this.pacman.x*t+(t-e)/2,l=this.pacman.y*t+(t-e)/2;this.pacman.angle=(this.pacman.angle+.1)%(Math.PI*2);const i=Math.sin(this.pacman.angle)*.3+.4;switch(this.ctx.save(),this.ctx.translate(n+e/2,l+e/2),this.pacman.direction){case"up":this.ctx.rotate(-Math.PI/2);break;case"down":this.ctx.rotate(Math.PI/2);break;case"left":this.ctx.rotate(Math.PI);break;case"right":this.ctx.rotate(0);break}this.ctx.fillStyle="#ffcc00",this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.arc(0,0,e/2,i,Math.PI*2-i),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#000",this.ctx.beginPath(),this.ctx.arc(e*.25,-e*.25,e*.1,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()},drawGhosts(t){const e=t*.8;this.ghosts.forEach(n=>{const l=n.x*t+(t-e)/2,i=n.y*t+(t-e)/2;this.ctx.save(),this.ctx.fillStyle=n.isAfraid?"#6666ff":n.color,this.ctx.beginPath(),this.ctx.moveTo(l,i),this.ctx.lineTo(l+e,i),this.ctx.quadraticCurveTo(l+e,i+e,l+e*.75,i+e*.75),this.ctx.lineTo(l+e*.5,i+e),this.ctx.lineTo(l+e*.25,i+e*.75),this.ctx.lineTo(l,i+e),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.arc(l+e*.3125,i+e*.375,e*.1875,0,Math.PI*2),this.ctx.arc(l+e*.6875,i+e*.375,e*.1875,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#000",this.ctx.beginPath(),this.ctx.arc(l+e*.3125,i+e*.375,e*.0625,0,Math.PI*2),this.ctx.arc(l+e*.6875,i+e*.375,e*.0625,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()})},isValidMove(t,e){if(t<0||t>=this.GRID_SIZE||e<0||e>=this.GRID_SIZE)return!1;const n=this.gameGrid[e][t];return n.type!=="#"&&n.type!=="="},getNextPosition(t,e){const n={...t};switch(e){case"up":n.y--;break;case"down":n.y++;break;case"left":n.x--;break;case"right":n.x++;break}return n},movePacman(){this.isValidMove(this.getNextPosition(this.pacman,this.pacman.nextDirection).x,this.getNextPosition(this.pacman,this.pacman.nextDirection).y)&&(this.pacman.direction=this.pacman.nextDirection);const t=this.getNextPosition(this.pacman,this.pacman.direction);if(this.isValidMove(t.x,t.y)){const e=this.gameGrid[t.y][t.x];e.type==="."?(this.score+=1,e.type=" "):e.type==="o"&&(this.score+=5,e.type=" ",this.ghosts.forEach(n=>{n.isAfraid=!0,n.afraidTimer=100})),this.pacman.x=t.x,this.pacman.y=t.y,this.checkGhostCollision(),this.checkGameOver()}},moveGhosts(){for(let t=0;t<this.ghosts.length;t++){const e=this.ghosts[t];if(e.isAfraid&&(e.afraidTimer--,e.afraidTimer<=0&&(e.isAfraid=!1)),Math.random()<.2){const l=["up","down","left","right"],i=[];for(let o=0;o<l.length;o++){const r=l[o],d=this.getNextPosition(e,r);this.isValidMove(d.x,d.y)&&i.push(r)}if(i.length>0){const o=Math.floor(Math.random()*i.length);e.direction=i[o]}}const n=this.getNextPosition(e,e.direction);this.isValidMove(n.x,n.y)&&(e.x=n.x,e.y=n.y)}this.checkGhostCollision()},checkGhostCollision(){for(let t=0;t<this.ghosts.length;t++){const e=this.ghosts[t];e.x===this.pacman.x&&e.y===this.pacman.y&&(e.isAfraid?(this.score+=5,e.x=10,e.y=6,e.isAfraid=!1):this.gameOver())}},checkGameOver(){let t=!1;for(let e=0;e<this.GRID_SIZE;e++){for(let n=0;n<this.GRID_SIZE;n++)if(this.gameGrid[e][n].type==="."||this.gameGrid[e][n].type==="o"){t=!0;break}if(t)break}t||this.gameOver(!0)},gameOver(t=!1){this.clearIntervals(),this.isGameRunning=!1,this.isGameOver=!0,this.submitScore()},startGame(){this.isGameRunning||(this.isGameRunning=!0,this.isPaused=!1,this.isGameOver=!1,this.gameStartTime=Date.now(),this.timeUsed=0,this.timeInterval=setInterval(()=>{this.timeUsed=Math.floor((Date.now()-this.gameStartTime)/1e3)},1e3),this.gameInterval=setInterval(()=>{this.isPaused||(Date.now()-this.gameStartTime>this.SAFE_TIME&&this.moveGhosts(),this.isMobileDevice()&&this.movePacman(),this.drawGame())},this.GAME_SPEED))},pauseGame(){this.isPaused=!this.isPaused},toggleGame(){this.isGameRunning?this.pauseGame():this.startGame()},resetGame(){this.clearIntervals(),this.score=0,this.timeUsed=0,this.pacman={x:1,y:18,direction:"up",nextDirection:"up",width:16,height:16,angle:0},this.isGameRunning=!1,this.isPaused=!1,this.isGameOver=!1,this.initGame()},clearIntervals(){clearInterval(this.gameInterval),clearInterval(this.timeInterval),clearTimeout(this.longPressTimer),clearInterval(this.longPressInterval),clearTimeout(this.mobileLongPressTimer),clearInterval(this.mobileLongPressInterval)},isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Tablet|Mobile/i.test(navigator.userAgent)||navigator.maxTouchPoints>0&&window.innerWidth<1024},handleDirectionKey(t){let e;switch(t){case"ArrowUp":case"w":case"W":e="up";break;case"ArrowDown":case"s":case"S":e="down";break;case"ArrowLeft":case"a":case"A":e="left";break;case"ArrowRight":case"d":case"D":e="right";break;default:return}this.pacman.nextDirection=e,this.isGameRunning&&!this.isPaused&&(this.movePacman(),this.drawGame()),clearTimeout(this.longPressTimer),clearInterval(this.longPressInterval),this.isGameRunning&&!this.isPaused&&(this.longPressInterval=setInterval(()=>{this.movePacman(),this.drawGame()},this.GAME_SPEED))},handleDirectionKeyUp(){clearTimeout(this.longPressTimer),clearInterval(this.longPressInterval)},handleMobileDirection(t){this.pacman.nextDirection=t,this.isGameRunning&&!this.isPaused&&(this.movePacman(),this.drawGame()),clearTimeout(this.mobileLongPressTimer),clearInterval(this.mobileLongPressInterval),this.mobileLongPressTimer=setTimeout(()=>{this.isGameRunning&&!this.isPaused&&(this.mobileLongPressInterval=setInterval(()=>{this.movePacman(),this.drawGame()},this.GAME_SPEED))},this.LONG_PRESS_DELAY)},handleMobileDirectionUp(){clearTimeout(this.mobileLongPressTimer),clearInterval(this.mobileLongPressInterval)},handleKeyDown(t){if(!this.keyState[t.key])switch(this.keyState[t.key]=!0,t.key){case"ArrowUp":case"w":case"W":case"ArrowDown":case"s":case"S":case"ArrowLeft":case"a":case"A":case"ArrowRight":case"d":case"D":this.handleDirectionKey(t.key);break;case" ":this.isGameRunning?this.pauseGame():this.startGame();break}},handleKeyUp(t){this.keyState[t.key]=!1,Object.keys(this.keyState).some(n=>["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","W","s","S","a","A","d","D"].includes(n)&&this.keyState[n])||this.handleDirectionKeyUp()},addEventListeners(){window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this)),window.addEventListener("resize",this.setCanvasSize.bind(this))},removeEventListeners(){window.removeEventListener("keydown",this.handleKeyDown.bind(this)),window.removeEventListener("keyup",this.handleKeyUp.bind(this)),window.removeEventListener("resize",this.setCanvasSize.bind(this))},checkLoginStatus(){const t=localStorage.getItem("pacman_user");t&&(this.currentUser=JSON.parse(t))},async submitScore(){if(this.currentUser)try{const t=this.isMobileDevice()?"mobile":"desktop",n=await(await fetch("/api/scores",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:this.currentUser.id,score:this.score,time_used:this.timeUsed,device_type:t})})).json();n.rank&&console.log("分数提交成功，排名:",n.rank)}catch(t){console.error("提交分数失败:",t)}}}},He={class:"pacman-game"},Ze={class:"header"},Xe={class:"scoreboard"},et={id:"score"},tt={class:"scoreboard"},st={id:"timeUsed"},it={class:"game-container"},rt={id:"gameCanvas",ref:"gameCanvas"},nt={key:0,class:"game-over",id:"gameOver"},ot={class:"controls"},lt={class:"mobile-controls"},at={class:"control-pad"},ht={class:"control-row"};function ct(t,e,n,l,i,o){return h(),a("div",He,[s("div",Ze,[e[17]||(e[17]=s("h1",null,"吃豆豆",-1)),s("div",Xe,[e[14]||(e[14]=k(" 得分: ",-1)),s("span",et,c(i.score),1)]),s("div",tt,[e[15]||(e[15]=k(" 用时: ",-1)),s("span",st,c(i.timeUsed),1),e[16]||(e[16]=k("秒 ",-1))])]),s("div",it,[s("canvas",rt,null,512),i.isGameOver?(h(),a("div",nt,[e[20]||(e[20]=s("h2",null,"游戏结束",-1)),s("p",null,[e[18]||(e[18]=k("最终得分: ",-1)),s("span",null,c(i.score),1)]),s("p",null,[e[19]||(e[19]=k("用时: ",-1)),s("span",null,c(i.timeUsed)+"秒",1)]),s("button",{class:"btn",onClick:e[0]||(e[0]=(...r)=>o.resetGame&&o.resetGame(...r))},"重新开始"),s("button",{class:"btn",onClick:e[1]||(e[1]=r=>t.$router.push("/leaderboard"))},"查看排行榜")])):u("",!0)]),s("div",ot,[e[21]||(e[21]=s("p",null,"使用方向键或WASD控制移动",-1)),s("button",{class:"btn",onClick:e[2]||(e[2]=r=>t.$router.push("/"))},"返回首页"),s("button",{class:"btn",id:"startPauseBtn",onClick:e[3]||(e[3]=(...r)=>o.toggleGame&&o.toggleGame(...r))},c(o.gameButtonText),1),s("button",{class:"btn",onClick:e[4]||(e[4]=(...r)=>o.resetGame&&o.resetGame(...r))},"重置"),s("button",{class:"btn",onClick:e[5]||(e[5]=r=>t.$router.push("/leaderboard"))},"排行榜")]),s("div",lt,[s("div",at,[s("button",{class:"control-btn up-btn",onTouchstart:e[6]||(e[6]=r=>o.handleMobileDirection("up")),onTouchend:e[7]||(e[7]=(...r)=>o.handleMobileDirectionUp&&o.handleMobileDirectionUp(...r))},"↑",32),s("div",ht,[s("button",{class:"control-btn left-btn",onTouchstart:e[8]||(e[8]=r=>o.handleMobileDirection("left")),onTouchend:e[9]||(e[9]=(...r)=>o.handleMobileDirectionUp&&o.handleMobileDirectionUp(...r))},"←",32),s("button",{class:"control-btn down-btn",onTouchstart:e[10]||(e[10]=r=>o.handleMobileDirection("down")),onTouchend:e[11]||(e[11]=(...r)=>o.handleMobileDirectionUp&&o.handleMobileDirectionUp(...r))},"↓",32),s("button",{class:"control-btn right-btn",onTouchstart:e[12]||(e[12]=r=>o.handleMobileDirection("right")),onTouchend:e[13]||(e[13]=(...r)=>o.handleMobileDirectionUp&&o.handleMobileDirectionUp(...r))},"→",32)])])])])}const dt=b(Ye,[["render",ct],["__scopeId","data-v-c671c812"]]),ut={name:"TetrisGame",data(){return{currentUser:null,showUserMenu:!1,isMobile:!1,gameStarted:!1,gamePaused:!1,isGameOver:!1,score:0,level:1,lines:0,rank:null,backgroundMusic:null,canvas:null,ctx:null,gameWidth:0,gameHeight:0,blockSize:0,grid:[],currentPiece:null,dropInterval:1e3,lastDropTime:0,animationId:null,leftIntervalId:null,rightIntervalId:null,downIntervalId:null,LONG_PRESS_DELAY:1e3,LONG_PRESS_INTERVAL:100,isTouching:{left:!1,right:!1,down:!1},lastClickTime:{left:0,right:0,down:0},CLICK_DELAY:300}},computed:{gameButtonText(){return this.gameStarted?this.gamePaused?"继续游戏":"暂停游戏":"开始游戏"}},mounted(){this.checkLoginStatus(),this.checkMobile(),this.initializeGame(),this.addEventListeners(),this.backgroundMusic=this.$refs.backgroundMusic},beforeUnmount(){this.removeEventListeners(),this.clearIntervals()},methods:{checkLoginStatus(){const t=localStorage.getItem("pacman_user");t&&(this.currentUser=JSON.parse(t))},truncateUsername(t,e){return t.length<=e?t:t.substring(0,e-2)+".."},toggleUserMenu(){this.showUserMenu=!this.showUserMenu},logout(){localStorage.removeItem("pacman_user"),this.currentUser=null,this.showUserMenu=!1},async changeUsername(){const t=this.currentUser.username,e=prompt("请输入新的用户名:",t);if(e===null)return;const n=e.trim();if(n!==t&&n)try{const i=await(await fetch("/api/auth/update_username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:this.currentUser.id,new_username:n})})).json();i.error?alert(i.error):(this.currentUser.username=n,localStorage.setItem("pacman_user",JSON.stringify(this.currentUser)),alert("用户名修改成功"))}catch(l){console.error("修改用户名失败:",l),alert("修改用户名失败，请稍后重试")}},preventDefaultTouch(t){t.preventDefault()},preventScroll(t){["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," ","PageUp","PageDown","Home","End"].includes(t.key)&&t.preventDefault()},preventZoom(t){t.ctrlKey&&t.preventDefault()},checkMobile(){this.isMobile=window.innerWidth<=768},initializeGame(){this.canvas=this.$refs.gameCanvas,this.ctx=this.canvas.getContext("2d"),this.calculateGameSize(),this.initGrid(),this.drawGame()},calculateGameSize(){const t=window.innerWidth,e=window.innerHeight,n=t-10,r=50+40+100+40;let d=e-r;d<180&&(d=180),this.blockSize=Math.floor(Math.min(n/12,d/20)),this.blockSize<18&&(this.blockSize=18),this.gameWidth=this.blockSize*12,this.gameHeight=this.blockSize*20,this.canvas.width=this.gameWidth,this.canvas.height=this.gameHeight},initGrid(){this.grid=[];for(let t=0;t<20;t++){this.grid[t]=[];for(let e=0;e<12;e++)this.grid[t][e]=0}},spawnPiece(){const t={I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],J:[[1,0,0],[1,1,1],[0,0,0]],L:[[0,0,1],[1,1,1],[0,0,0]],O:[[1,1],[1,1]],S:[[0,1,1],[1,1,0],[0,0,0]],T:[[0,1,0],[1,1,1],[0,0,0]],Z:[[1,1,0],[0,1,1],[0,0,0]]},e={I:"#00ffff",J:"#4169e1",L:"#ff6347",O:"#ffff66",S:"#32cd32",T:"#9400d3",Z:"#ff4500"},n=Object.keys(t),l=n[Math.floor(Math.random()*n.length)];this.currentPiece={shape:t[l],color:e[l],x:4,y:0,type:l},this.isValidMove(this.currentPiece.shape,this.currentPiece.x,this.currentPiece.y)||this.gameOver()},drawGame(){this.ctx.clearRect(0,0,this.gameWidth,this.gameHeight),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.gameWidth,this.gameHeight);for(let t=0;t<20;t++)for(let e=0;e<12;e++)this.grid[t][e]&&this.drawBlock(e*this.blockSize,t*this.blockSize,this.grid[t][e]);if(this.currentPiece){for(let t=0;t<this.currentPiece.shape.length;t++)for(let e=0;e<this.currentPiece.shape[t].length;e++)if(this.currentPiece.shape[t][e]){const n=this.currentPiece.x+e,l=this.currentPiece.y+t;l>=0&&this.drawBlock(n*this.blockSize,l*this.blockSize,this.currentPiece.color,!0)}}this.ctx.strokeStyle="#00ffaa",this.ctx.lineWidth=2,this.ctx.strokeRect(0,0,this.gameWidth,this.gameHeight)},drawBlock(t,e,n,l=!1){const i=this.blockSize-2;l&&(this.ctx.shadowColor=n,this.ctx.shadowBlur=5,this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2);const o=this.ctx.createLinearGradient(t,e,t+i,e+i);o.addColorStop(0,this.lightenColor(n,40)),o.addColorStop(.5,n),o.addColorStop(1,this.darkenColor(n,40)),this.ctx.fillStyle=o,this.ctx.fillRect(t,e,i,i),this.ctx.strokeStyle=this.lightenColor(n,50),this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,i,i),this.ctx.strokeStyle=this.darkenColor(n,50),this.ctx.lineWidth=1,this.ctx.strokeRect(t+1,e+1,i-2,i-2),l&&(this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0)},lightenColor(t,e){const n=parseInt(t.replace("#",""),16),l=Math.round(2.55*e),i=(n>>16)+l,o=(n>>8&255)+l,r=(n&255)+l;return"#"+(16777216+(i<255?i<1?0:i:255)*65536+(o<255?o<1?0:o:255)*256+(r<255?r<1?0:r:255)).toString(16).slice(1)},darkenColor(t,e){const n=parseInt(t.replace("#",""),16),l=Math.round(2.55*e),i=(n>>16)-l,o=(n>>8&255)-l,r=(n&255)-l;return"#"+(16777216+(i>255?255:i<0?0:i)*65536+(o>255?255:o<0?0:o)*256+(r>255?255:r<0?0:r)).toString(16).slice(1)},moveLeft(){!this.isGameOver&&!this.gamePaused&&this.currentPiece&&this.isValidMove(this.currentPiece.shape,this.currentPiece.x-1,this.currentPiece.y)&&(this.currentPiece.x--,this.drawGame())},moveRight(){!this.isGameOver&&!this.gamePaused&&this.currentPiece&&this.isValidMove(this.currentPiece.shape,this.currentPiece.x+1,this.currentPiece.y)&&(this.currentPiece.x++,this.drawGame())},moveDown(){!this.isGameOver&&!this.gamePaused&&this.currentPiece&&(this.isValidMove(this.currentPiece.shape,this.currentPiece.x,this.currentPiece.y+1)?(this.currentPiece.y++,this.drawGame()):(this.lockPiece(),this.clearLines(),this.spawnPiece(),this.drawGame()))},hardDrop(){if(!this.isGameOver&&!this.gamePaused&&this.currentPiece){for(;this.isValidMove(this.currentPiece.shape,this.currentPiece.x,this.currentPiece.y+1);)this.currentPiece.y++;this.lockPiece(),this.clearLines(),this.spawnPiece(),this.drawGame()}},rotatePiece(){if(this.isGameOver||this.gamePaused||!this.currentPiece)return;const t=this.rotateMatrix(this.currentPiece.shape);this.isValidMove(t,this.currentPiece.x,this.currentPiece.y)&&(this.currentPiece.shape=t,this.drawGame())},rotateMatrix(t){const e=t.length,n=t[0].length,l=[];for(let i=0;i<n;i++){l[i]=[];for(let o=e-1;o>=0;o--)l[i][e-1-o]=t[o][i]}return l},isValidMove(t,e,n){for(let l=0;l<t.length;l++)for(let i=0;i<t[l].length;i++)if(t[l][i]){const o=e+i,r=n+l;if(o<0||o>=12||r>=20||r>=0&&this.grid[r]&&this.grid[r][o])return!1}return!0},lockPiece(){for(let t=0;t<this.currentPiece.shape.length;t++)for(let e=0;e<this.currentPiece.shape[t].length;e++)if(this.currentPiece.shape[t][e]){const n=this.currentPiece.y+t,l=this.currentPiece.x+e;n>=0&&(this.grid[n][l]=this.currentPiece.color)}},clearLines(){let t=0;for(let e=19;e>=0;e--)if(this.grid[e].every(n=>n!==0)){for(let n=e;n>0;n--)this.grid[n]=[...this.grid[n-1]];this.grid[0]=Array(12).fill(0),t++,e++}if(t>0){const e=t*this.level;this.score+=e,this.lines+=t;const n=Math.floor(this.lines/100)+1;n>this.level&&(this.level=n,this.dropInterval=Math.max(100,this.dropInterval*.95))}},gameOver(){this.isGameOver=!0,this.clearIntervals(),this.backgroundMusic&&(this.backgroundMusic.pause(),this.backgroundMusic.currentTime=0),this.submitScore()},async submitScore(){if(this.currentUser)try{const t=this.isMobile?"mobile":"desktop",n=await(await fetch("/api/tetris/scores",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:this.currentUser.id,score:this.score,device_type:t})})).json();n.rank&&(console.log("分数提交成功，排名:",n.rank),this.rank=n.rank)}catch(t){console.error("提交分数失败:",t)}},gameLoop(t){if(this.isGameOver||this.gamePaused){this.animationId=requestAnimationFrame(this.gameLoop);return}t>this.lastDropTime+this.dropInterval&&(this.moveDown(),this.lastDropTime=t),this.animationId=requestAnimationFrame(this.gameLoop)},startGame(){this.gameStarted?(this.gamePaused=!this.gamePaused,this.gamePaused?this.backgroundMusic&&this.backgroundMusic.pause():(this.lastDropTime=performance.now(),this.backgroundMusic&&this.backgroundMusic.play().catch(t=>{console.log("播放背景音乐失败:",t)}))):(this.gameStarted=!0,this.gamePaused=!1,this.isGameOver=!1,this.score=0,this.level=1,this.lines=0,this.dropInterval=1e3,this.lastDropTime=0,this.initGrid(),this.spawnPiece(),this.drawGame(),this.backgroundMusic&&(this.backgroundMusic.volume=.3,this.backgroundMusic.play().catch(t=>{console.log("自动播放被阻止:",t)})),this.lastDropTime=performance.now(),this.animationId=requestAnimationFrame(this.gameLoop))},toggleGame(){this.backgroundMusic&&(this.backgroundMusic.volume=.3,this.backgroundMusic.play().catch(t=>{console.log("音频播放初始化:",t)})),this.startGame()},resetGame(){this.clearIntervals(),this.gameStarted=!1,this.gamePaused=!1,this.isGameOver=!1,this.score=0,this.level=1,this.lines=0,this.currentPiece=null,this.backgroundMusic&&(this.backgroundMusic.pause(),this.backgroundMusic.currentTime=0),this.initGrid(),this.drawGame()},restartGame(){this.resetGame(),this.startGame()},clearIntervals(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.leftIntervalId&&(clearTimeout(this.leftIntervalId),clearInterval(this.leftIntervalId),this.leftIntervalId=null),this.rightIntervalId&&(clearTimeout(this.rightIntervalId),clearInterval(this.rightIntervalId),this.rightIntervalId=null),this.downIntervalId&&(clearTimeout(this.downIntervalId),clearInterval(this.downIntervalId),this.downIntervalId=null)},handleLeftDown(t){if(t.type==="touchstart"){if(this.isTouching.left)return;this.isTouching.left=!0}const e=Date.now();e-this.lastClickTime.left<this.CLICK_DELAY||(this.lastClickTime.left=e,this.moveLeft(),this.leftIntervalId=setTimeout(()=>{this.leftIntervalId=setInterval(this.moveLeft,this.LONG_PRESS_INTERVAL)},this.LONG_PRESS_DELAY))},handleLeftUp(t){(t.type==="touchend"||t.type==="touchcancel")&&(this.isTouching.left=!1),this.leftIntervalId&&(clearTimeout(this.leftIntervalId),clearInterval(this.leftIntervalId),this.leftIntervalId=null)},handleRightDown(t){if(t.type==="touchstart"){if(this.isTouching.right)return;this.isTouching.right=!0}const e=Date.now();e-this.lastClickTime.right<this.CLICK_DELAY||(this.lastClickTime.right=e,this.moveRight(),this.rightIntervalId=setTimeout(()=>{this.rightIntervalId=setInterval(this.moveRight,this.LONG_PRESS_INTERVAL)},this.LONG_PRESS_DELAY))},handleRightUp(t){(t.type==="touchend"||t.type==="touchcancel")&&(this.isTouching.right=!1),this.rightIntervalId&&(clearTimeout(this.rightIntervalId),clearInterval(this.rightIntervalId),this.rightIntervalId=null)},handleDownDown(t){if(t.type==="touchstart"){if(this.isTouching.down)return;this.isTouching.down=!0}const e=Date.now();e-this.lastClickTime.down<this.CLICK_DELAY||(this.lastClickTime.down=e,this.moveDown(),this.downIntervalId=setTimeout(()=>{this.downIntervalId=setInterval(this.moveDown,this.LONG_PRESS_INTERVAL)},this.LONG_PRESS_DELAY))},handleDownUp(t){(t.type==="touchend"||t.type==="touchcancel")&&(this.isTouching.down=!1),this.downIntervalId&&(clearTimeout(this.downIntervalId),clearInterval(this.downIntervalId),this.downIntervalId=null)},addEventListeners(){window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("resize",this.handleResize.bind(this)),window.addEventListener("keydown",this.preventScroll.bind(this)),window.addEventListener("wheel",this.preventZoom.bind(this)),document.addEventListener("dblclick",t=>t.preventDefault())},removeEventListeners(){window.removeEventListener("keydown",this.handleKeyDown.bind(this)),window.removeEventListener("resize",this.handleResize.bind(this)),window.removeEventListener("keydown",this.preventScroll.bind(this)),window.removeEventListener("wheel",this.preventZoom.bind(this)),document.removeEventListener("dblclick",t=>t.preventDefault())},handleKeyDown(t){switch(t.key){case"ArrowLeft":this.moveLeft();break;case"ArrowRight":this.moveRight();break;case"ArrowDown":this.moveDown();break;case"ArrowUp":this.rotatePiece();break;case" ":t.preventDefault(),this.hardDrop();break}},handleResize(){this.checkMobile(),this.calculateGameSize(),this.drawGame()},handleCanvasTouchStart(t){t.preventDefault(),this.rotatePiece()}}},mt={class:"container"},pt={ref:"backgroundMusic",loop:"",preload:"auto"},gt={class:"title-container"},ft={key:0,class:"user-info"},yt={class:"relative"},vt=["title"],bt={key:0,class:"user-menu"},wt={class:"game-container"},kt={class:"game-info"},xt={class:"info-item"},Pt={class:"score"},Tt={class:"info-item"},It={class:"info-item"},St={class:"level"},Ut={class:"game-area"},Ct={key:0,class:"game-over"},Mt={class:"game-over-stats"},Gt={class:"stat-item"},Ft={class:"stat-value"},Lt={class:"stat-item"},Et={class:"stat-value"},Dt={key:0,class:"stat-item"},Rt={class:"stat-value rank"},Ot={class:"game-over-buttons"},At={class:"controls-container"},Nt={class:"footer"};function Jt(t,e,n,l,i,o){return h(),a("div",{class:"tetris-game",onContextmenu:e[24]||(e[24]=f(()=>{},["prevent"]))},[s("div",mt,[s("audio",pt,[...e[25]||(e[25]=[s("source",{src:"https://assets.codepen.io/21542/Tetris.mp3",type:"audio/mpeg"},null,-1)])],512),s("div",gt,[s("button",{class:"btn home-btn",onClick:e[0]||(e[0]=r=>t.$router.push("/"))},"返回首页"),e[26]||(e[26]=s("h1",null,"俄罗斯方块",-1)),i.currentUser?(h(),a("div",ft,[s("div",yt,[s("span",{class:"username",onClick:e[1]||(e[1]=(...r)=>o.toggleUserMenu&&o.toggleUserMenu(...r)),title:i.currentUser.username},c(o.truncateUsername(i.currentUser.username,8)),9,vt),i.showUserMenu?(h(),a("div",bt,[s("button",{onClick:e[2]||(e[2]=(...r)=>o.logout&&o.logout(...r))},"退出登录"),s("button",{onClick:e[3]||(e[3]=r=>t.$router.push("/login?action=change"))},"修改密码"),s("button",{onClick:e[4]||(e[4]=(...r)=>o.changeUsername&&o.changeUsername(...r))},"修改用户名")])):u("",!0)])])):u("",!0)]),s("div",wt,[s("div",kt,[s("div",xt,[e[27]||(e[27]=s("label",null,"分数",-1)),s("div",Pt,c(i.score),1)]),s("div",Tt,[s("button",{class:"start-btn",onClick:e[5]||(e[5]=(...r)=>o.toggleGame&&o.toggleGame(...r))},c(o.gameButtonText),1)]),s("div",It,[e[28]||(e[28]=s("label",null,"等级",-1)),s("div",St,c(i.level),1)])]),s("div",Ut,[s("canvas",{ref:"gameCanvas",id:"gameCanvas",onClick:e[6]||(e[6]=(...r)=>o.rotatePiece&&o.rotatePiece(...r)),onTouchstart:e[7]||(e[7]=(...r)=>o.handleCanvasTouchStart&&o.handleCanvasTouchStart(...r)),onWheel:e[8]||(e[8]=f(()=>{},["prevent"]))},null,544),i.isGameOver?(h(),a("div",Ct,[e[32]||(e[32]=s("h2",null,"游戏结束",-1)),s("div",Mt,[s("div",Gt,[e[29]||(e[29]=s("span",{class:"stat-label"},"最终得分",-1)),s("span",Ft,c(i.score),1)]),s("div",Lt,[e[30]||(e[30]=s("span",{class:"stat-label"},"等级",-1)),s("span",Et,c(i.level),1)]),i.rank?(h(),a("div",Dt,[e[31]||(e[31]=s("span",{class:"stat-label"},"本次排名",-1)),s("span",Rt,c(i.rank),1)])):u("",!0)]),s("div",Ot,[s("button",{class:"restart-btn",onClick:e[9]||(e[9]=(...r)=>o.restartGame&&o.restartGame(...r))},"重新开始"),s("button",{class:"leaderboard-btn",onClick:e[10]||(e[10]=r=>t.$router.push("/tetris-leaderboard"))},"查看排行榜")])])):u("",!0),s("div",At,[s("button",{id:"leftBtn",class:"control-btn",onMousedown:e[11]||(e[11]=(...r)=>o.handleLeftDown&&o.handleLeftDown(...r)),onMouseup:e[12]||(e[12]=(...r)=>o.handleLeftUp&&o.handleLeftUp(...r)),onMouseleave:e[13]||(e[13]=(...r)=>o.handleLeftUp&&o.handleLeftUp(...r)),onTouchstart:e[14]||(e[14]=(...r)=>o.handleLeftDown&&o.handleLeftDown(...r)),onTouchend:e[15]||(e[15]=(...r)=>o.handleLeftUp&&o.handleLeftUp(...r))}," ← ",32),s("button",{id:"downBtn",class:"control-btn",onClick:e[16]||(e[16]=(...r)=>o.hardDrop&&o.hardDrop(...r))}," ↓ "),s("button",{id:"rightBtn",class:"control-btn",onMousedown:e[17]||(e[17]=(...r)=>o.handleRightDown&&o.handleRightDown(...r)),onMouseup:e[18]||(e[18]=(...r)=>o.handleRightUp&&o.handleRightUp(...r)),onMouseleave:e[19]||(e[19]=(...r)=>o.handleRightUp&&o.handleRightUp(...r)),onTouchstart:e[20]||(e[20]=(...r)=>o.handleRightDown&&o.handleRightDown(...r)),onTouchend:e[21]||(e[21]=(...r)=>o.handleRightUp&&o.handleRightUp(...r))}," → ",32)])])]),s("div",Nt,[i.currentUser?u("",!0):(h(),a("button",{key:0,class:"btn btn-secondary",onClick:e[22]||(e[22]=r=>t.$router.push("/login"))},"登录")),i.currentUser?u("",!0):(h(),a("button",{key:1,class:"btn btn-secondary",onClick:e[23]||(e[23]=r=>t.$router.push("/register"))},"注册"))])])],32)}const jt=b(ut,[["render",Jt],["__scopeId","data-v-c199dd40"]]),_t={name:"TetrisLeaderboard",data(){return{currentUser:null,showUserMenu:!1,leaderboard:[],userScore:null,userRank:null,loading:!1,message:"",messageType:""}},mounted(){this.checkLoginStatus(),this.fetchLeaderboard()},methods:{checkLoginStatus(){const t=localStorage.getItem("pacman_user");t&&(this.currentUser=JSON.parse(t),this.fetchUserScore())},truncateUsername(t,e){return t.length<=e?t:t.substring(0,e-2)+".."},toggleUserMenu(){this.showUserMenu=!this.showUserMenu},logout(){localStorage.removeItem("pacman_user"),this.currentUser=null,this.showUserMenu=!1,this.fetchLeaderboard()},async changeUsername(){const t=this.currentUser.username,e=prompt("请输入新的用户名:",t);if(e===null)return;const n=e.trim();if(n!==t&&n)try{const i=await(await fetch("/api/auth/update_username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:this.currentUser.id,new_username:n})})).json();i.error?alert(i.error):(this.currentUser.username=n,localStorage.setItem("pacman_user",JSON.stringify(this.currentUser)),this.fetchLeaderboard(),this.fetchUserScore(),alert("用户名修改成功"))}catch(l){console.error("修改用户名失败:",l),alert("修改用户名失败，请稍后重试")}},async fetchLeaderboard(){this.loading=!0;try{const e=await(await fetch("/api/tetris/scores?limit=20")).json();this.leaderboard=e.scores||[]}catch(t){console.error("获取排行榜失败:",t),this.message="获取排行榜失败，请刷新页面",this.messageType="error"}finally{this.loading=!1}},async fetchUserScore(){if(this.currentUser)try{const e=await(await fetch(`/api/tetris/scores/user/${this.currentUser.id}`)).json();e.rank&&(this.userRank=e.rank,this.userScore={score:e.score,device_type:e.device_type||"desktop"})}catch(t){console.error("获取用户分数失败:",t)}}}},zt={class:"tetris-leaderboard"},Bt={class:"container"},qt={class:"header"},Vt={key:0,class:"user-info"},Qt={class:"relative"},Kt=["title"],Wt={key:0,class:"user-menu"},$t={key:1,class:"user-info"},Yt={key:0,class:"message info"},Ht={key:2,class:"leaderboard-table"},Zt={key:0,class:"user-row"},Xt=["title"],es=["title"],ts={key:1},ss={key:3,class:"loading"},is={class:"footer"};function rs(t,e,n,l,i,o){return h(),a("div",zt,[s("div",Bt,[e[13]||(e[13]=s("h1",null,"俄罗斯方块 - 排行榜",-1)),s("div",qt,[i.currentUser?(h(),a("div",Vt,[s("div",Qt,[s("button",{class:"btn",onClick:e[0]||(e[0]=(...r)=>o.toggleUserMenu&&o.toggleUserMenu(...r)),title:i.currentUser.username},c(o.truncateUsername(i.currentUser.username,8)),9,Kt),i.showUserMenu?(h(),a("div",Wt,[s("button",{onClick:e[1]||(e[1]=(...r)=>o.logout&&o.logout(...r))},"退出登录"),s("button",{onClick:e[2]||(e[2]=r=>t.$router.push("/login?action=change"))},"修改密码"),s("button",{onClick:e[3]||(e[3]=(...r)=>o.changeUsername&&o.changeUsername(...r))},"修改用户名")])):u("",!0)])])):(h(),a("div",$t,[...e[9]||(e[9]=[s("p",null,"未登录",-1)])]))]),i.currentUser?u("",!0):(h(),a("div",Yt," 如需将成绩计入排行榜，请先登录 ")),i.message?(h(),a("div",{key:1,class:w(["message",i.messageType])},c(i.message),3)):u("",!0),i.loading?u("",!0):(h(),a("table",Ht,[e[11]||(e[11]=s("thead",null,[s("tr",null,[s("th",null,"排名"),s("th",null,"用户名"),s("th",null,"分数"),s("th",null,"设备")])],-1)),s("tbody",null,[i.userScore?(h(),a("tr",Zt,[s("td",null,c(i.userRank),1),s("td",{title:i.currentUser.username},c(o.truncateUsername(i.currentUser.username,12))+" (你)",9,Xt),s("td",null,c(i.userScore.score),1),s("td",null,c(i.userScore.device_type==="mobile"?"手机":"电脑"),1)])):u("",!0),(h(!0),a(U,null,C(i.leaderboard,r=>(h(),a("tr",{key:r.rank},[s("td",null,c(r.rank),1),s("td",{title:r.username},c(o.truncateUsername(r.username,12)),9,es),s("td",null,c(r.score),1),s("td",null,c(r.device_type==="mobile"?"手机":"电脑"),1)]))),128)),i.leaderboard.length===0?(h(),a("tr",ts,[...e[10]||(e[10]=[s("td",{colspan:"4",style:{"text-align":"center",padding:"20px"}},"暂无排行榜数据",-1)])])):u("",!0)])])),i.loading?(h(),a("div",ss,[...e[12]||(e[12]=[s("p",null,"加载中...",-1)])])):u("",!0),s("div",is,[s("button",{class:"btn",onClick:e[4]||(e[4]=r=>t.$router.push("/"))},"返回首页"),s("button",{class:"btn",onClick:e[5]||(e[5]=r=>t.$router.push("/tetris"))},"开始游戏"),i.currentUser?u("",!0):(h(),a("button",{key:0,class:"btn btn-secondary",onClick:e[6]||(e[6]=r=>t.$router.push("/login"))},"登录")),i.currentUser?u("",!0):(h(),a("button",{key:1,class:"btn btn-secondary",onClick:e[7]||(e[7]=r=>t.$router.push("/register"))},"注册")),s("button",{class:"btn btn-secondary",onClick:e[8]||(e[8]=r=>t.$router.push("/leaderboard"))},"吃豆豆排行榜")])])])}const ns=b(_t,[["render",rs],["__scopeId","data-v-675da2d3"]]),os={name:"TankGame",data(){return{currentUser:null,showUserMenu:!1,canvas:null,ctx:null,player:null,enemies:[],bullets:[],terrain:[],walls:[],explosions:[],lives:3,score:0,level:1,gameOver:!1,gameStarted:!1,gamePaused:!1,gameLoop:null,keys:{up:!1,left:!1,right:!1,down:!1,space:!1},isMobile:!1,moveInterval:null,joystickActive:!1,joystickCenter:{x:0,y:0},joystickRadius:60,joystickMaxDistance:40,mapSeed:0}},mounted(){this.checkLoginStatus(),this.checkMobile(),this.initGame(),this.setupEventListeners()},beforeUnmount(){this.cleanup()},methods:{checkLoginStatus(){const t=localStorage.getItem("pacman_user");t&&(this.currentUser=JSON.parse(t))},checkMobile(){this.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},truncateUsername(t,e){return t.length<=e?t:t.substring(0,e-2)+".."},toggleUserMenu(){this.showUserMenu=!this.showUserMenu},logout(){localStorage.removeItem("pacman_user"),this.currentUser=null,this.showUserMenu=!1},async changeUsername(){const t=this.currentUser.username,e=prompt("请输入新的用户名:",t);if(e===null)return;const n=e.trim();if(n!==t&&n)try{const i=await(await fetch("/api/auth/update_username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:this.currentUser.id,new_username:n})})).json();i.error?alert(i.error):(this.currentUser.username=n,localStorage.setItem("pacman_user",JSON.stringify(this.currentUser)),alert("用户名修改成功"))}catch(l){console.error("修改用户名失败:",l),alert("修改用户名失败，请稍后重试")}},initGame(){this.canvas=this.$refs.gameCanvas,this.ctx=this.canvas.getContext("2d"),this.resetGame(),this.drawInitialScreen(),this.gameStarted&&(this.gameLoop=setInterval(()=>this.updateGame(),16))},drawInitialScreen(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawTerrain()},resetGame(){this.mapSeed=Math.floor(Math.random()*1e4),this.lives=3,this.score=0,this.level=1,this.gameOver=!1,this.player={x:168,y:456,width:24,height:24,direction:0,speed:2,fireRate:200,lastFire:0},this.enemies=[];const t=[{x:72,y:48},{x:240,y:48},{x:408,y:48}],e=["normal","fast","smart"];t.forEach((i,o)=>{this.enemies.push({x:i.x,y:i.y,width:24,height:24,direction:2,speed:1,fireRate:1e3,lastFire:0,type:e[o%e.length]})}),this.terrain=[];const n=21,l=24;for(let i=0;i<n;i++)for(let o=0;o<n;o++){const r=this.generateTerrain(o,i);if(r!=="floor"){const d={x:o*l,y:i*l,width:l,height:l,type:r};r==="brick"&&(d.health=3),this.terrain.push(d)}}this.bullets=[],this.explosions=[],console.log("Terrain elements generated:",this.terrain.length),console.log("Terrain elements:",this.terrain)},generateTerrain(t,e){if(t===10&&e===20)return"base";if(t===10&&e===19)return"floor";if(t>=9&&t<=11&&e===18||t===9&&e>=18&&e<=20||t===11&&e>=18&&e<=20||t>=9&&t<=11&&e===21)return"brick";if(e<3||e>17||(t===10||t===11)&&e>=5&&e<=13||(t===3||t===4)&&e>=6&&e<=11||(t===16||t===17)&&e>=6&&e<=11)return"floor";const n=(t*7+e*13+this.mapSeed)%100;return t>=1&&t<=5&&e>=5&&e<=8&&n<70||t>=15&&t<=19&&e>=5&&e<=8&&n<70||t>=1&&t<=5&&e>=10&&e<=13&&n<70||t>=15&&t<=19&&e>=10&&e<=13&&n<70?"brick":t>=6&&t<=14&&e>=6&&e<=8&&n>60&&n<90||t>=6&&t<=14&&e>=10&&e<=12&&n>60&&n<90?"steel":t>=1&&t<=5&&e>=9&&e<=10&&n<40||t>=15&&t<=19&&e>=9&&e<=10&&n<40?"water":t>=5&&t<=15&&e>=7&&e<=11&&n<50?"forest":"floor"},setupEventListeners(){window.addEventListener("keydown",t=>{switch(t.key){case"ArrowUp":this.keys.up=!0;break;case"ArrowLeft":this.keys.left=!0;break;case"ArrowRight":this.keys.right=!0;break;case"ArrowDown":this.keys.down=!0;break;case" ":this.keys.space=!0,this.fire();break}}),window.addEventListener("keyup",t=>{switch(t.key){case"ArrowUp":this.keys.up=!1;break;case"ArrowLeft":this.keys.left=!1;break;case"ArrowRight":this.keys.right=!1;break;case"ArrowDown":this.keys.down=!1;break;case" ":this.keys.space=!1;break}})},startMove(t){this.keys[t]=!0,t==="up"?this.player.direction=0:t==="left"?this.player.direction=3:t==="right"?this.player.direction=1:t==="down"&&(this.player.direction=2),this.moveInterval||(this.moveInterval=setInterval(()=>{this.movePlayer()},20))},stopMove(t){this.keys[t]=!1,!this.keys.up&&!this.keys.left&&!this.keys.right&&!this.keys.down&&(clearInterval(this.moveInterval),this.moveInterval=null)},movePlayer(){this.keys.up?(this.player.direction=0,this.player.y-=this.player.speed):this.keys.left?(this.player.direction=3,this.player.x-=this.player.speed):this.keys.right?(this.player.direction=1,this.player.x+=this.player.speed):this.keys.down&&(this.player.direction=2,this.player.y+=this.player.speed),this.player.x=Math.max(0,Math.min(this.canvas.width-this.player.width,this.player.x)),this.player.y=Math.max(0,Math.min(this.canvas.height-this.player.height,this.player.y)),this.checkCollisions()},fire(){const t=Date.now();if(t-this.player.lastFire<this.player.fireRate)return;this.player.lastFire=t;let e,n,l;switch(this.player.direction){case 0:e=this.player.x+this.player.width/2-2,n=this.player.y-10,l=0;break;case 1:e=this.player.x+this.player.width+2,n=this.player.y+this.player.height/2-2,l=1;break;case 2:e=this.player.x+this.player.width/2-2,n=this.player.y+this.player.height+2,l=2;break;case 3:e=this.player.x-10,n=this.player.y+this.player.height/2-2,l=3;break}this.bullets.push({x:e,y:n,width:4,height:4,direction:l,speed:5,type:"player"})},updateGame(){this.gameOver||!this.gameStarted||this.gamePaused||(this.movePlayer(),this.moveEnemies(),this.moveBullets(),this.enemiesFire(),this.checkCollisions(),this.checkGameOver(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawTerrain(),this.drawPlayer(),this.drawEnemies(),this.drawBullets(),this.drawExplosions())},drawPlayer(){let t=!1;for(let e=0;e<this.terrain.length;e++){const n=this.terrain[e];if(n.type==="forest"&&this.checkCollision(this.player,n)){t=!0;break}}t||(this.ctx.save(),this.ctx.translate(this.player.x+this.player.width/2,this.player.y+this.player.height/2),this.ctx.rotate(this.player.direction*Math.PI/2),this.ctx.translate(-(this.player.x+this.player.width/2),-(this.player.y+this.player.height/2)),this.ctx.fillStyle="#00FF00",this.ctx.fillRect(this.player.x+2,this.player.y+2,this.player.width-4,this.player.height-4),this.ctx.fillStyle="#000000",this.ctx.fillRect(this.player.x,this.player.y+2,2,this.player.height-4),this.ctx.fillRect(this.player.x+this.player.width-2,this.player.y+2,2,this.player.height-4),this.ctx.fillStyle="#008000",this.ctx.fillRect(this.player.x+4,this.player.y,this.player.width-8,this.player.height),this.ctx.fillStyle="#00FF00",this.ctx.fillRect(this.player.x+this.player.width/2-1,this.player.y-8,2,10),this.ctx.fillStyle="#008000",this.ctx.fillRect(this.player.x+this.player.width/2-2,this.player.y-10,4,2),this.ctx.restore())},drawEnemies(){for(let t=0;t<this.enemies.length;t++){const e=this.enemies[t];let n=!1;for(let d=0;d<this.terrain.length;d++){const g=this.terrain[d];if(g.type==="forest"&&this.checkCollision(e,g)){n=!0;break}}if(n)continue;this.ctx.save(),this.ctx.translate(e.x+e.width/2,e.y+e.height/2),this.ctx.rotate(e.direction*Math.PI/2),this.ctx.translate(-(e.x+e.width/2),-(e.y+e.height/2));let l,i,o,r;switch(e.type){case"fast":l="#FF69B4",i="#FF1493",o="#FF69B4",r="#FF1493";break;case"heavy":l="#808080",i="#404040",o="#808080",r="#404040";break;case"smart":l="#FFFFFF",i="#C0C0C0",o="#FFFFFF",r="#C0C0C0";break;default:l="#FF0000",i="#800000",o="#FF0000",r="#800000"}this.ctx.fillStyle=l,this.ctx.fillRect(e.x+2,e.y+2,e.width-4,e.height-4),this.ctx.fillStyle="#000000",this.ctx.fillRect(e.x,e.y+2,2,e.height-4),this.ctx.fillRect(e.x+e.width-2,e.y+2,2,e.height-4),this.ctx.fillStyle=i,this.ctx.fillRect(e.x+4,e.y,e.width-8,e.height),this.ctx.fillStyle=o,this.ctx.fillRect(e.x+e.width/2-1,e.y-8,2,10),this.ctx.fillStyle=r,this.ctx.fillRect(e.x+e.width/2-2,e.y-10,4,2),this.ctx.restore()}},drawTerrain(){for(let t=0;t<this.terrain.length;t++){const e=this.terrain[t];switch(e.type){case"brick":this.ctx.fillStyle="#FF8C00",this.ctx.fillRect(e.x,e.y,e.width,e.height),this.ctx.fillStyle="#FF4500",this.ctx.fillRect(e.x+4,e.y+4,e.width-8,e.height-8);break;case"steel":this.ctx.fillStyle="#C0C0C0",this.ctx.fillRect(e.x,e.y,e.width,e.height),this.ctx.strokeStyle="#808080",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(e.x+4,e.y),this.ctx.lineTo(e.x+4,e.y+e.height),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e.x+8,e.y),this.ctx.lineTo(e.x+8,e.y+e.height),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e.x+12,e.y),this.ctx.lineTo(e.x+12,e.y+e.height),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y+4),this.ctx.lineTo(e.x+e.width,e.y+4),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y+8),this.ctx.lineTo(e.x+e.width,e.y+8),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y+12),this.ctx.lineTo(e.x+e.width,e.y+12),this.ctx.stroke();break;case"water":this.ctx.fillStyle="#0000FF",this.ctx.fillRect(e.x,e.y,e.width,e.height);break;case"forest":this.ctx.fillStyle="#008000",this.ctx.fillRect(e.x,e.y,e.width,e.height);break;case"base":this.ctx.fillStyle="#FFFF00",this.ctx.fillRect(e.x,e.y,e.width,e.height),this.ctx.fillStyle="#FFA500",this.ctx.fillRect(e.x+6,e.y+3,8,14),this.ctx.fillRect(e.x+3,e.y+6,14,8);break}}},drawBullets(){for(let t=0;t<this.bullets.length;t++){const e=this.bullets[t],n=e.type==="player"?"#00FF00":"#FF0000";this.ctx.fillStyle=n,this.ctx.fillRect(e.x,e.y,e.width,e.height)}},moveEnemies(){for(let t=0;t<this.enemies.length;t++){const e=this.enemies[t];Math.random()<.02&&(e.direction=Math.floor(Math.random()*4)),Math.random()<.1&&(Math.abs(this.player.x-e.x)>Math.abs(this.player.y-e.y)?this.player.x>e.x?e.direction=1:this.player.x<e.x&&(e.direction=3):this.player.y>e.y?e.direction=2:this.player.y<e.y&&(e.direction=0)),e.x,e.y;let n=e.x,l=e.y;switch(e.direction){case 0:l-=e.speed;break;case 1:n+=e.speed;break;case 2:l+=e.speed;break;case 3:n-=e.speed;break}const i={...e,x:n,y:l};let o=!1;for(let r=0;r<this.terrain.length;r++){const d=this.terrain[r];if(d.type!=="forest"&&this.checkCollision(i,d)){o=!0;break}}o?e.direction=(e.direction+1)%4:(n=Math.max(0,Math.min(this.canvas.width-e.width,n)),l=Math.max(0,Math.min(this.canvas.height-e.height,l)),e.x=n,e.y=l),e.type==="fast"?e.speed=1.5:e.type==="heavy"?e.speed=.8:e.type==="smart"&&Math.random()<.2&&(this.player.x>e.x?e.direction=1:this.player.x<e.x?e.direction=3:this.player.y>e.y?e.direction=2:this.player.y<e.y&&(e.direction=0))}},moveBullets(){const t=[];for(let e=0;e<this.bullets.length;e++){const n=this.bullets[e];switch(n.direction){case 0:n.y-=n.speed;break;case 1:n.x+=n.speed;break;case 2:n.y+=n.speed;break;case 3:n.x-=n.speed;break}n.x>=0&&n.x<=this.canvas.width&&n.y>=0&&n.y<=this.canvas.height&&t.push(n)}this.bullets=t},enemiesFire(){const t=Date.now();for(let e=0;e<this.enemies.length;e++){const n=this.enemies[e];if(!(t-n.lastFire<n.fireRate)&&Math.random()<.01){n.lastFire=t;let l,i,o;switch(n.direction){case 0:l=n.x+n.width/2-2,i=n.y-10,o=0;break;case 1:l=n.x+n.width+2,i=n.y+n.height/2-2,o=1;break;case 2:l=n.x+n.width/2-2,i=n.y+n.height+2,o=2;break;case 3:l=n.x-10,i=n.y+n.height/2-2,o=3;break}this.bullets.push({x:l,y:i,width:4,height:4,direction:o,speed:5,type:"enemy"})}}},checkCollisions(){for(let r=0;r<this.terrain.length;r++){const d=this.terrain[r];if(d.type!=="forest"&&this.checkCollision(this.player,d)){const g=this.player.x,m=this.player.y,p=[{dx:0,dy:-this.player.speed},{dx:0,dy:this.player.speed},{dx:-this.player.speed,dy:0},{dx:this.player.speed,dy:0}];let I=1/0,T={x:g,y:m};for(const P of p)if(this.player.x=g+P.dx,this.player.y=m+P.dy,!this.checkCollision(this.player,d)){const S=Math.abs(P.dx)+Math.abs(P.dy);S<I&&(I=S,T={x:this.player.x,y:this.player.y})}this.player.x=T.x,this.player.y=T.y;break}}for(let r=0;r<this.enemies.length;r++){const d=this.enemies[r];for(let g=0;g<this.terrain.length;g++){const m=this.terrain[g];if(m.type!=="forest"&&this.checkCollision(d,m)){switch(d.direction=(d.direction+1)%4,d.direction){case 0:d.y+=d.speed;break;case 1:d.x-=d.speed;break;case 2:d.y-=d.speed;break;case 3:d.x+=d.speed;break}break}}}let t=[...this.terrain];const e=[];for(let r=0;r<this.bullets.length;r++){const d=this.bullets[r];let g=!1;for(let m=0;m<t.length;m++){const p=t[m];if(this.checkCollision(d,p)){if(p.type==="forest"||p.type==="water")continue;g=!0,p.type==="brick"&&(p.health--,this.createExplosion(p.x+p.width/2,p.y+p.height/2),p.health<=0&&(t.splice(m,1),m--)),p.type==="base"&&(this.createExplosion(p.x+p.width/2,p.y+p.height/2),this.gameOver=!0);break}}g||e.push(d)}this.terrain=t,this.bullets=e;const n=[],l=[],i=new Array(this.enemies.length).fill(!1);for(let r=0;r<this.bullets.length;r++){const d=this.bullets[r];if(d.type==="player"){let g=!1;for(let m=0;m<this.enemies.length;m++){const p=this.enemies[m];if(!i[m]&&this.checkCollision(d,p))switch(this.createExplosion(p.x+p.width/2,p.y+p.height/2),g=!0,i[m]=!0,p.type){case"fast":this.score+=300;break;case"heavy":this.score+=200;break;case"smart":this.score+=400;break;default:this.score+=100;break}}g||n.push(d)}else n.push(d)}for(let r=0;r<this.enemies.length;r++)i[r]||l.push(this.enemies[r]);this.bullets=n,this.enemies=l;const o=[];for(let r=0;r<this.bullets.length;r++){const d=this.bullets[r];d.type==="enemy"&&this.checkCollision(d,this.player)?(this.createExplosion(this.player.x+this.player.width/2,this.player.y+this.player.height/2),this.lives--,this.lives<=0&&(this.gameOver=!0)):o.push(d)}this.bullets=o;for(let r=0;r<this.enemies.length;r++){const d=this.enemies[r];this.checkCollision(this.player,d)&&(this.createExplosion(this.player.x+this.player.width/2,this.player.y+this.player.height/2),this.createExplosion(d.x+d.width/2,d.y+d.height/2),this.lives--,this.lives<=0&&(this.gameOver=!0));for(let g=0;g<this.terrain.length;g++){const m=this.terrain[g];m.type==="base"&&this.checkCollision(d,m)&&(this.createExplosion(m.x+m.width/2,m.y+m.height/2),this.gameOver=!0)}}},checkCollision(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y},createExplosion(t,e){this.explosions.push({x:t,y:e,size:0,maxSize:40,alpha:1,startTime:Date.now()})},drawExplosions(){const t=[];for(let e=0;e<this.explosions.length;e++){const n=this.explosions[e],l=Date.now()-n.startTime,i=500;if(l>i)continue;const o=l/i;n.size=n.maxSize*o,n.alpha=1-o,this.ctx.globalAlpha=n.alpha,this.ctx.fillStyle="#FF8C00",this.ctx.fillRect(n.x-n.size/2,n.y-n.size/2,n.size,n.size),this.ctx.fillStyle="#FFFF00",this.ctx.fillRect(n.x-n.size/4,n.y-n.size/4,n.size/2,n.size/2),this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(n.x-n.size/6,n.y-n.size/6,n.size/3,n.size/3),this.ctx.globalAlpha=1,t.push(n)}this.explosions=t},checkGameOver(){if(this.lives<=0&&(this.gameOver=!0,clearInterval(this.gameLoop)),this.enemies.length===0){this.level++;const t=["normal","fast","smart"];for(let e=0;e<5+this.level;e++)this.enemies.push({x:100+e*100,y:50,width:30,height:30,direction:2,speed:1+this.level*.1,fireRate:1e3-this.level*50,lastFire:0,type:t[e%t.length]})}},restartGame(){clearInterval(this.gameLoop),this.initGame()},resetGameOnly(){this.gameStarted=!1,this.gamePaused=!1,clearInterval(this.gameLoop),this.initGame()},handleGameControl(){this.gameStarted?this.gamePaused?this.startGame():this.pauseGame():this.startGame()},startGame(){this.gameStarted?this.gamePaused&&(this.gamePaused=!1,this.gameLoop=setInterval(()=>this.updateGame(),20)):(this.gameStarted=!0,this.gamePaused=!1,this.initGame())},pauseGame(){this.gameStarted&&!this.gameOver&&!this.gamePaused&&(this.gamePaused=!0,clearInterval(this.gameLoop))},cleanup(){clearInterval(this.gameLoop),this.moveInterval&&clearInterval(this.moveInterval),window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp)},handleScreenTouch(t){if(this.isMobile&&this.gameStarted&&!this.gamePaused){const e=t.target;!e.closest("button")&&!e.closest(".joystick-container")&&this.fire()}},startJoystick(t){if(t.stopPropagation(),console.log("startJoystick called"),this.joystickActive=!0,this.$refs.joystickBase){const e=this.$refs.joystickBase.getBoundingClientRect();this.joystickCenter={x:e.left+e.width/2,y:e.top+e.height/2},console.log("Joystick center:",this.joystickCenter)}this.moveJoystick(t)},moveJoystick(t){if(!this.joystickActive)return;const e=t.touches[0];if(!e||!this.joystickCenter)return;const n=e.clientX-this.joystickCenter.x,l=e.clientY-this.joystickCenter.y,i=Math.sqrt(n*n+l*l),o=this.joystickMaxDistance;let r=n,d=l;i>o&&(r=n/i*o,d=l/i*o),this.$refs.joystickThumb&&(this.$refs.joystickThumb.style.transform=`translate(${r}px, ${d}px)`,console.log("Joystick position updated:",r,d));const g=r/o,m=d/o;this.updatePlayerMovement(g,m)},stopJoystick(){console.log("stopJoystick called"),this.joystickActive=!1,this.$refs.joystickThumb?(console.log("Resetting joystick position"),this.$refs.joystickThumb.style.transform="translate(0, 0)",console.log("Joystick position reset to center")):console.log("joystickThumb ref not found"),this.keys.up=!1,this.keys.down=!1,this.keys.left=!1,this.keys.right=!1,this.joystickCenter=null},updatePlayerMovement(t,e){!this.gameStarted||this.gamePaused||(this.keys.up=!1,this.keys.down=!1,this.keys.left=!1,this.keys.right=!1,Math.abs(e)>Math.abs(t)?e<-.3?(this.keys.up=!0,this.player.direction=0):e>.3&&(this.keys.down=!0,this.player.direction=2):t<-.3?(this.keys.left=!0,this.player.direction=3):t>.3&&(this.keys.right=!0,this.player.direction=1))}}},ls={class:"container"},as={class:"title-container"},hs={key:0,class:"user-info"},cs={class:"relative"},ds=["title"],us={key:0,class:"user-menu"},ms={class:"game-container"},ps={class:"game-info"},gs={class:"lives"},fs={class:"score"},ys={class:"level"},vs={ref:"gameCanvas",class:"game-canvas",width:"520",height:"520"},bs={class:"game-controls"},ws={key:0,class:"mobile-controls"},ks={class:"joystick-container"},xs={class:"joystick-base",ref:"joystickBase"},Ps={key:0,class:"game-over-panel"},Ts={class:"footer"};function Is(t,e,n,l,i,o){return h(),a("div",{class:"tank-game",onContextmenu:e[27]||(e[27]=f(()=>{},["prevent"])),onTouchstart:e[28]||(e[28]=(...r)=>o.handleScreenTouch&&o.handleScreenTouch(...r))},[s("div",ls,[s("div",as,[s("button",{class:"btn home-btn",onClick:e[0]||(e[0]=r=>t.$router.push("/")),onTouchstart:e[1]||(e[1]=f(()=>{},["stop"]))},"返回首页",32),e[29]||(e[29]=s("h1",null,"坦克大战",-1)),i.currentUser?(h(),a("div",hs,[s("div",cs,[s("span",{class:"username",onClick:e[2]||(e[2]=(...r)=>o.toggleUserMenu&&o.toggleUserMenu(...r)),title:i.currentUser.username,onTouchstart:e[3]||(e[3]=f(()=>{},["stop"]))},c(o.truncateUsername(i.currentUser.username,8)),41,ds),i.showUserMenu?(h(),a("div",us,[s("button",{onClick:e[4]||(e[4]=(...r)=>o.logout&&o.logout(...r)),onTouchstart:e[5]||(e[5]=f(()=>{},["stop"]))},"退出登录",32),s("button",{onClick:e[6]||(e[6]=r=>t.$router.push("/login?action=change")),onTouchstart:e[7]||(e[7]=f(()=>{},["stop"]))},"修改密码",32),s("button",{onClick:e[8]||(e[8]=(...r)=>o.changeUsername&&o.changeUsername(...r)),onTouchstart:e[9]||(e[9]=f(()=>{},["stop"]))},"修改用户名",32)])):u("",!0)])])):u("",!0)]),s("div",ms,[s("div",ps,[s("div",gs,"生命: "+c(i.lives),1),s("div",fs,"分数: "+c(i.score),1),s("div",ys,"等级: "+c(i.level),1)]),s("canvas",vs,null,512),s("div",bs,[s("button",{class:"btn start-btn",onClick:e[10]||(e[10]=(...r)=>o.handleGameControl&&o.handleGameControl(...r)),onKeydown:e[11]||(e[11]=E(f(()=>{},["prevent"]),["space"])),onTouchstart:e[12]||(e[12]=f(()=>{},["stop"]))},c(i.gameStarted?i.gamePaused?"继续游戏":"暂停游戏":"开始游戏"),33),s("button",{class:"btn reset-btn",onClick:e[13]||(e[13]=(...r)=>o.resetGameOnly&&o.resetGameOnly(...r)),onTouchstart:e[14]||(e[14]=f(()=>{},["stop"]))}," 重置游戏 ",32)]),i.isMobile?(h(),a("div",ws,[s("div",ks,[s("div",xs,[s("div",{class:"joystick-thumb",ref:"joystickThumb",onTouchstart:e[15]||(e[15]=(...r)=>o.startJoystick&&o.startJoystick(...r)),onTouchmove:e[16]||(e[16]=(...r)=>o.moveJoystick&&o.moveJoystick(...r)),onTouchend:e[17]||(e[17]=(...r)=>o.stopJoystick&&o.stopJoystick(...r)),onTouchcancel:e[18]||(e[18]=(...r)=>o.stopJoystick&&o.stopJoystick(...r))},null,544)],512)])])):u("",!0)]),i.gameOver?(h(),a("div",Ps,[e[30]||(e[30]=s("h2",null,"游戏结束",-1)),s("p",null,"最终分数: "+c(i.score),1),s("p",null,"最终等级: "+c(i.level),1),s("button",{class:"btn",onClick:e[19]||(e[19]=(...r)=>o.restartGame&&o.restartGame(...r)),onTouchstart:e[20]||(e[20]=f(()=>{},["stop"]))},"重新开始",32),s("button",{class:"btn btn-secondary",onClick:e[21]||(e[21]=r=>t.$router.push("/")),onTouchstart:e[22]||(e[22]=f(()=>{},["stop"]))},"返回首页",32)])):u("",!0),s("div",Ts,[i.currentUser?u("",!0):(h(),a("button",{key:0,class:"btn btn-secondary",onClick:e[23]||(e[23]=r=>t.$router.push("/login")),onTouchstart:e[24]||(e[24]=f(()=>{},["stop"]))},"登录",32)),i.currentUser?u("",!0):(h(),a("button",{key:1,class:"btn btn-secondary",onClick:e[25]||(e[25]=r=>t.$router.push("/register")),onTouchstart:e[26]||(e[26]=f(()=>{},["stop"]))},"注册",32))])])],32)}const Ss=b(os,[["render",Is],["__scopeId","data-v-a9b2dd15"]]),Us={name:"MBTITest",data(){return{currentQuestion:0,selectedOption:null,answers:[],dimensions:{EI:0,SN:0,TF:0,JP:0},resultType:"",resultTitle:"",resultDescription:"",questions:[{question:"你更喜欢？",options:["与很多人交往，参加社交活动","独处或与少数亲密朋友相处"],dimension:"EI",weight:[1,0]},{question:"你更倾向于？",options:["注重事实和细节","关注整体和可能性"],dimension:"SN",weight:[1,0]},{question:"做决定时，你更依赖？",options:["逻辑和分析","情感和价值观"],dimension:"TF",weight:[1,0]},{question:"你更喜欢？",options:["有计划、有组织的生活","灵活、即兴的生活"],dimension:"JP",weight:[1,0]},{question:"你通常？",options:["先行动，再思考","先思考，再行动"],dimension:"EI",weight:[1,0]},{question:"你更关注？",options:["现实的、具体的事物","抽象的、理论的概念"],dimension:"SN",weight:[1,0]},{question:"在团队中，你更看重？",options:["公正和客观","和谐和包容"],dimension:"TF",weight:[1,0]},{question:"你更倾向于？",options:["提前计划，避免意外","随遇而安，适应变化"],dimension:"JP",weight:[1,0]},{question:"你觉得自己是一个？",options:["健谈的人","安静的人"],dimension:"EI",weight:[1,0]},{question:"你更相信？",options:["经验和实际证据","直觉和灵感"],dimension:"SN",weight:[1,0]},{question:"你更重视？",options:["原则和规则","个人感受和需求"],dimension:"TF",weight:[1,0]},{question:"你更喜欢？",options:["完成任务后再放松","边工作边娱乐"],dimension:"JP",weight:[1,0]}],resultTypes:{ESTJ:{title:"执行官",description:"ESTJ 类型的人是实际、逻辑、分析型的决策者，他们重视传统和秩序，善于组织和管理，是天生的领导者。"},ESFJ:{title:"领事",description:"ESFJ 类型的人是热情、友好、有责任感的人，他们重视和谐和人际关系，善于照顾他人，是团队中的支持者。"},ENTJ:{title:"指挥官",description:"ENTJ 类型的人是自信、果断、有远见的领导者，他们善于制定计划和战略，是天生的组织者和决策者。"},ENFJ:{title:"主人公",description:"ENFJ 类型的人是热情、理想主义、有感染力的领导者，他们善于理解他人，是天生的激励者和引导者。"},ISTJ:{title:"检查员",description:"ISTJ 类型的人是实际、可靠、注重细节的人，他们重视传统和秩序，善于执行计划和任务。"},ISFJ:{title:"守护者",description:"ISFJ 类型的人是温和、体贴、有责任感的人，他们重视和谐和稳定，善于照顾他人的需求。"},INTJ:{title:"建筑师",description:"INTJ 类型的人是独立、创新、有远见的思考者，他们善于分析和解决复杂问题，是天生的战略家。"},INFJ:{title:"提倡者",description:"INFJ 类型的人是理想主义、有洞察力、有同情心的人，他们善于理解他人，是天生的顾问和引导者。"},ESTP:{title:"企业家",description:"ESTP 类型的人是灵活、冒险、行动导向的人，他们善于适应变化，是天生的问题解决者和冒险家。"},ESFP:{title:"表演者",description:"ESFP 类型的人是热情、活泼、善于社交的人，他们重视当下的体验，是天生的娱乐者和社交达人。"},ENTP:{title:"辩论家",description:"ENTP 类型的人是好奇、创新、善于分析的人，他们喜欢挑战传统，是天生的思想家和发明家。"},ENFP:{title:"竞选者",description:"ENFP 类型的人是热情、理想主义、富有创造力的人，他们善于发现可能性，是天生的激励者和创新者。"},ISTP:{title:"鉴赏家",description:"ISTP 类型的人是冷静、务实、善于动手的人，他们善于解决实际问题，是天生的技术专家和冒险家。"},ISFP:{title:"探险家",description:"ISFP 类型的人是温和、敏感、富有创造力的人，他们重视个人价值观，是天生的艺术家和自由精神。"},INTP:{title:"逻辑学家",description:"INTP 类型的人是理性、好奇、善于分析的人，他们喜欢探索理论和概念，是天生的思想家和科学家。"},INFP:{title:"调停者",description:"INFP 类型的人是理想主义、敏感、富有创造力的人，他们重视个人价值观和意义，是天生的诗人和哲学家。"}}}},methods:{startTest(){this.currentQuestion=2,this.selectedOption=null,this.answers=[],this.dimensions={EI:0,SN:0,TF:0,JP:0}},selectOption(t){this.selectedOption=t},previousQuestion(){this.currentQuestion--,this.selectedOption=this.answers[this.currentQuestion-2]},nextQuestion(){if(this.selectedOption!==null){this.answers.push(this.selectedOption);const t=this.questions[this.currentQuestion-2];this.selectedOption===0?this.dimensions[t.dimension]+=t.weight[0]:this.dimensions[t.dimension]+=t.weight[1],this.currentQuestion++,this.selectedOption=null,this.currentQuestion>this.questions.length&&this.calculateResult()}},calculateResult(){const t=this.answers.filter((o,r)=>this.questions[r].dimension==="EI").length,e=this.answers.filter((o,r)=>this.questions[r].dimension==="SN").length,n=this.answers.filter((o,r)=>this.questions[r].dimension==="TF").length,l=this.answers.filter((o,r)=>this.questions[r].dimension==="JP").length;this.dimensions.EI=this.dimensions.EI/t,this.dimensions.SN=this.dimensions.SN/e,this.dimensions.TF=this.dimensions.TF/n,this.dimensions.JP=this.dimensions.JP/l;let i="";i+=this.dimensions.EI>.5?"E":"I",i+=this.dimensions.SN>.5?"S":"N",i+=this.dimensions.TF>.5?"T":"F",i+=this.dimensions.JP>.5?"J":"P",this.resultType=i,this.resultTitle=this.resultTypes[i].title,this.resultDescription=this.resultTypes[i].description},restartTest(){this.currentQuestion=0,this.selectedOption=null,this.answers=[],this.dimensions={EI:0,SN:0,TF:0,JP:0},this.resultType="",this.resultTitle="",this.resultDescription=""}}},Cs={class:"mbti-test"},Ms={class:"container"},Gs={key:0,class:"test-intro"},Fs={key:1,class:"test-questions"},Ls={class:"question-progress"},Es={class:"progress-bar"},Ds={class:"question-card"},Rs={class:"options"},Os={class:"question-actions"},As=["disabled"],Ns={key:2,class:"test-result"},Js={class:"result-card"},js={class:"result-type"},_s={class:"result-description"},zs={class:"result-details"},Bs={class:"dimensions"},qs={class:"dimension"},Vs={class:"dimension-bar"},Qs={class:"dimension"},Ks={class:"dimension-bar"},Ws={class:"dimension"},$s={class:"dimension-bar"},Ys={class:"dimension"},Hs={class:"dimension-bar"},Zs={class:"footer"};function Xs(t,e,n,l,i,o){return h(),a("div",Cs,[s("div",Ms,[e[16]||(e[16]=s("h1",null,"MBTI 人格检测",-1)),i.currentQuestion===0?(h(),a("div",Gs,[e[7]||(e[7]=s("h2",null,"测试说明",-1)),e[8]||(e[8]=s("p",null,"MBTI（Myers-Briggs Type Indicator）是一种基于卡尔·荣格的心理类型理论的人格测试工具。通过回答以下问题，你将了解自己的人格类型。",-1)),e[9]||(e[9]=s("p",null,"请根据你的真实情况选择最符合你的选项，不要思考太久，凭第一感觉回答。",-1)),s("button",{class:"btn",onClick:e[0]||(e[0]=(...r)=>o.startTest&&o.startTest(...r))},"开始测试")])):i.currentQuestion<=i.questions.length?(h(),a("div",Fs,[s("div",Ls,[s("span",null,c(i.currentQuestion-1)+" / "+c(i.questions.length),1),s("div",Es,[s("div",{class:"progress",style:x({width:(i.currentQuestion-1)/i.questions.length*100+"%"})},null,4)])]),s("div",Ds,[s("h2",null,"问题 "+c(i.currentQuestion-1),1),s("p",null,c(i.questions[i.currentQuestion-2].question),1),s("div",Rs,[s("button",{class:w(["option-btn",{active:i.selectedOption===0}]),onClick:e[1]||(e[1]=r=>o.selectOption(0))},c(i.questions[i.currentQuestion-2].options[0]),3),s("button",{class:w(["option-btn",{active:i.selectedOption===1}]),onClick:e[2]||(e[2]=r=>o.selectOption(1))},c(i.questions[i.currentQuestion-2].options[1]),3)]),s("div",Os,[i.currentQuestion>2?(h(),a("button",{key:0,class:"btn btn-secondary",onClick:e[3]||(e[3]=(...r)=>o.previousQuestion&&o.previousQuestion(...r))},"上一题")):u("",!0),s("button",{class:"btn",onClick:e[4]||(e[4]=(...r)=>o.nextQuestion&&o.nextQuestion(...r)),disabled:i.selectedOption===null},"下一题",8,As)])])])):(h(),a("div",Ns,[e[15]||(e[15]=s("h2",null,"测试结果",-1)),s("div",Js,[s("div",js,[s("h3",null,c(i.resultType),1),s("p",null,c(i.resultTitle),1)]),s("div",_s,[s("p",null,c(i.resultDescription),1)]),s("div",zs,[e[14]||(e[14]=s("h4",null,"人格维度",-1)),s("div",Bs,[s("div",qs,[e[10]||(e[10]=s("span",null,"外向 (E) / 内向 (I)",-1)),s("div",Vs,[s("div",{class:"dimension-fill",style:x({width:i.dimensions.EI*100+"%"})},null,4)]),s("span",null,c(i.dimensions.EI>.5?"E":"I"),1)]),s("div",Qs,[e[11]||(e[11]=s("span",null,"感觉 (S) / 直觉 (N)",-1)),s("div",Ks,[s("div",{class:"dimension-fill",style:x({width:i.dimensions.SN*100+"%"})},null,4)]),s("span",null,c(i.dimensions.SN>.5?"S":"N"),1)]),s("div",Ws,[e[12]||(e[12]=s("span",null,"思考 (T) / 情感 (F)",-1)),s("div",$s,[s("div",{class:"dimension-fill",style:x({width:i.dimensions.TF*100+"%"})},null,4)]),s("span",null,c(i.dimensions.TF>.5?"T":"F"),1)]),s("div",Ys,[e[13]||(e[13]=s("span",null,"判断 (J) / 知觉 (P)",-1)),s("div",Hs,[s("div",{class:"dimension-fill",style:x({width:i.dimensions.JP*100+"%"})},null,4)]),s("span",null,c(i.dimensions.JP>.5?"J":"P"),1)])])]),s("button",{class:"btn",onClick:e[5]||(e[5]=(...r)=>o.restartTest&&o.restartTest(...r))},"重新测试")])])),s("div",Zs,[s("button",{class:"btn btn-secondary",onClick:e[6]||(e[6]=r=>t.$router.push("/"))},"返回首页")])])])}const ei=b(Us,[["render",Xs],["__scopeId","data-v-b1264d16"]]),ti={name:"BombermanGame",data(){return{isLoading:!1,gameLoaded:!1,loadingProgress:0}},mounted(){},methods:{startGame(){this.isLoading=!0,this.loadingProgress=0,this.loadUnityGame()},loadUnityGame(){const t=document.createElement("script");t.src="/bomberman/UnityLoader.js",t.onload=()=>{this.initializeUnityGame()},document.head.appendChild(t);const e=document.createElement("link");e.rel="stylesheet",e.href="/bomberman/style.css",document.head.appendChild(e)},initializeUnityGame(){window.UnityLoader?window.gameInstance=UnityLoader.instantiate("gameContainer","/bomberman/Build/Bomberman.json",{onProgress:(t,e)=>this.unityProgress(t,e)}):setTimeout(()=>this.initializeUnityGame(),100)},unityProgress(t,e){console.log("Unity game loading progress:",e),this.loadingProgress=e*100,e>=1&&(this.isLoading=!1,this.gameLoaded=!0)}}},si={class:"bomberman-game-container"},ii={class:"game-wrapper"},ri={id:"gameContainer",class:"game-container"},ni={key:0,class:"start-screen"},oi={key:1,class:"loading-screen"},li={class:"progress-container"},ai={class:"progress-text"};function hi(t,e,n,l,i,o){return h(),a("div",si,[e[4]||(e[4]=s("h1",{class:"game-title"},"炸弹人游戏",-1)),s("div",ii,[s("div",ri,[!i.gameLoaded&&!i.isLoading?(h(),a("div",ni,[e[1]||(e[1]=s("h2",null,"欢迎来到炸弹人游戏",-1)),e[2]||(e[2]=s("p",null,"准备好开始游戏了吗？",-1)),s("button",{class:"start-button",onClick:e[0]||(e[0]=(...r)=>o.startGame&&o.startGame(...r))},"开始游戏")])):u("",!0),i.isLoading?(h(),a("div",oi,[e[3]||(e[3]=s("h2",null,"游戏加载中...",-1)),s("div",li,[s("div",{class:"progress-bar",style:x({width:i.loadingProgress+"%"})},null,4)]),s("p",ai,c(Math.round(i.loadingProgress))+"%",1)])):u("",!0)])]),e[5]||(e[5]=s("div",{class:"game-instructions"},[s("h3",null,"游戏操作说明："),s("ul",null,[s("li",null,"WASD键：移动玩家"),s("li",null,"空格键：放置炸弹"),s("li",null,"ESC键：暂停游戏")])],-1))])}const ci=b(ti,[["render",hi],["__scopeId","data-v-f3d0bac8"]]),di=[{path:"/",name:"Index",component:ee},{path:"/leaderboard",name:"Leaderboard",component:be},{path:"/login",name:"Login",component:Ae},{path:"/register",name:"Register",component:$e},{path:"/game",name:"PacmanGame",component:dt},{path:"/tetris",name:"TetrisGame",component:jt},{path:"/tetris-leaderboard",name:"TetrisLeaderboard",component:ns},{path:"/mbti-test",name:"MBTITest",component:ei},{path:"/tank-game",name:"TankGame",component:Ss},{path:"/bomberman-game",name:"BombermanGame",component:ci}],ui=D({history:R(),routes:di}),M=O(j);M.use(ui);M.mount("#app");
